function [par, C, Cx, Cxx] = eqCcycle(x, par);
% ip is the mapping from x to parameter names (see switch below)
% output: C is model prediction of DIP,POP,and DOP
% output: F partial derivative of P model w.r.t. model parameters x
% output: Fxx hessian matrix of P model w.r.t.  model parameters x
    global GC
    on = true; off = false;
    iwet = par.iwet;
    nwet = par.nwet;

    % unpack the parameters to be optimized
    % bC_T
    if (par.opt_bC_T == on)
        par.bC_T = x(par.pindx.bC_T);
    end

    % bC
    if (par.opt_bC == on)
        lbC = x(par.pindx.lbC) ;
        par.bC  = exp(lbC)     ;
    end

    % d
    if (par.opt_d == on)
        ld = x(par.pindx.ld) ;
        par.d = exp(ld)      ;
    end

    % kC_T
    if (par.opt_kC_T == on)
        par.kC_T = x(par.pindx.kC_T);
    end

    % kdC
    if (par.opt_kdC == on)
        lkdC = x(par.pindx.lkdC);
        par.kdC  = exp(lkdC);
    end

    % R_Si
    if (par.opt_R_Si == on)
        par.R_Si = x(par.pindx.R_Si);
    end

    % rR
    if (par.opt_rR == on)
        lrR = x(par.pindx.lrR);
        par.rR = exp(lrR);
    end

    % cc
    if (par.opt_cc)
        lcc = x(par.pindx.lcc);
        par.cc = exp(lcc);
    end

    % dd
    if (par.opt_dd)
        ldd = x(par.pindx.ldd);
        par.dd = exp(ldd);
    end
    %
    options.iprint = 0   ;
    options.atol = 1e-10 ;
    options.rtol = 1e-10 ;
    fprintf('Solving C model ...\n') ;

    X0  = GC;
    [C,ierr] = nsnew(X0,@(X) C_eqn(X, par),options) ;
    par.Cfailure = off ;
    if (ierr ~= 0)
        fprintf('eqCcycle did not converge.\n') ;
        par.Cfailure = on;
        npx  = par.npx   ;
        ncx  = par.ncx   ;
		nbx  = par.nbx   ;
        nx   = npx + ncx + nbx;
        C    = GC ;
        Cx   = sparse(5*par.nwet, nx) ;
        Cxx  = sparse(5*par.nwet, nchoosek(nx,2)+nx) ;
        [par.G,par.Gx,par.Gxx] = uptake_C(par) ;
    elseif (ierr == 0 & par.optim == on)
        % reset the global variable for the next call eqCcycle
        GC = real(C) + 1e-8*randn(5*nwet,1) ;
        X0 = GC;
        F = C_eqn(C, par) ;
        % test if norm of F small enough, if not rerun nsnew;
        if (norm(F) > 1e-12)
            [C,ierr] = nsnew(X0,@(X) C_eqn(X, par),options);
        end
        %
        if nargout > 2
            [F,FD,Cx,Cxx,par] = C_eqn(C, par);
%{
			fprintf('Cx(:,pindx.lsigma) = %3.5e \n', max(real(Cx(:,par.pindx.lsigma)),[],'all'))
			fprintf('complex step of C: %3.5e \n', max(imag(C(:)),[],'all')/eps.^3)
			fprintf('dC_dsigma relative error: %3.5e \n \n', max(abs((real(Cx(:,par.pindx.lsigma)) - imag(C(:))/eps.^3)./(imag(C(:))/eps.^3)),[],'all'))

			fprintf('Cx(:,pindx.lkdP) = %3.5e \n', max(real(Cx(:,par.pindx.lkdP)),[],'all'))
			fprintf('complex step of C (kdP): %3.5e \n', max(imag(C(:)),[],'all')/eps.^3)
			fprintf('dC_dkdP relative error: %3.5e \n \n', max(abs((real(Cx(:,par.pindx.lkdP)) - imag(C(:))/eps.^3)./(imag(C(:))/eps.^3)),[],'all'))
%}
        end
    end
end

function [F,FD,Cx,Cxx,par] = C_eqn(X, par)
% unpack some useful stuff
    on = true; off = false;
    grd   = par.grd   ;
    M3d   = par.M3d   ;
    TRdiv = par.TRdiv ;
    iwet  = par.iwet  ;
    nwet  = par.nwet  ;
    dVt   = par.dVt   ;
    I     = par.I     ;

    Tz  = par.Tz ;
    DIC = X(0*nwet+1:1*nwet) ;
    POC = X(1*nwet+1:2*nwet) ;
    DOC = X(2*nwet+1:3*nwet) ;
    PIC = X(3*nwet+1:4*nwet) ;
    ALK = X(4*nwet+1:5*nwet) ;

    PO4 = par.po4obs(iwet) ;
    % fixed parameters
    kappa_p = par.kappa_p  ;
    kPIC    = par.kPIC     ;
    % parameters need to be optimized
    alpha = par.alpha    ;
    beta  = par.beta     ;
    sigma = par.sigma    ;
    bC_T  = par.bC_T     ;
    bC    = par.bC       ;
    d     = par.d        ;
    kC_T  = par.kC_T     ;
    kdC   = par.kdC      ;
    R_Si  = par.R_Si     ;
    rR    = par.rR       ;
    cc    = par.cc       ;
    dd    = par.dd       ;
    pme   = par.pme      ;
    % PIC to POC rain ratio
    vout  = mkPIC2P(par) ;
    RR    = vout.RR      ;
    RR_Si = vout.RR_Si   ;
    RR_rR = vout.RR_rR   ;
    clear vout
    % kappa_dc ;
    kC    = d0(kC_T * Tz + kdC) ;

	% Stoichiometric ratios
	if isfield(par,'CellOut')
		C2P = par.CellOut.C2P(iwet);
		% note C2P field is stored with 2 different sizes
		% size(par.C2P) =  [191169 , 1]
		% size(par.CellOut.C2P) = [90 , 180 , 24]

		%N2C = 1./par.CellOut.C2N(iwet);
		N2C   = 16/117 ;
		%fprintf('Using Cell Model Output for C2P \n')
	else
		C2P = 1./(cc*PO4 + dd);
		N2C   = 16/117 ;
		fprintf('Using Linear function of po4obs for C:P and constant N:C')
	end
    par.C2P = C2P  ;

    % particle flux div_rergence [s^-1];
    PFDa = buildPFD(par,'PIC') ;
    PFDc = buildPFD(par,'POC') ;
    par.PFDa = PFDa ;
    par.PFDc = PFDc ;
    par.DIC  = DIC  ;
    par.ALK  = ALK  ;
    % Air-Sea gas exchange
    vout  = Fsea2air(par, 'CO2');
    G_dic = vout.G_dic ;
    G_alk = vout.G_alk ;
    JgDIC = vout.JgDIC ;
    clear vout
    % biological DIC uptake operator
    G = uptake_C(par)  ; par.G = G ;

    kappa_g = par.kappa_g ;
    ALKbar  = par.ALKbar  ;
    sDICbar = par.sDICbar ;
    sALKbar = par.sALKbar ;

    eq1 = (I+(1-sigma)*RR)*(G*C2P) + TRdiv*DIC - kC*DOC - kPIC*PIC ...
          - JgDIC + pme*sDICbar ;
    eq2 = -(1-sigma)*G*C2P + (PFDc+kappa_p*I)*POC     ;
    eq3 = -sigma*G*C2P + (TRdiv+kC)*DOC - kappa_p*POC ;
    eq4 = -(1-sigma)*RR*(G*C2P) + (PFDa+kPIC*I)*PIC   ;
    eq5 = 2*(1-sigma)*RR*(G*C2P) + TRdiv*ALK - N2C.*(G*C2P) + N2C.*(kC*DOC) ...
          - 2*kPIC*PIC - kappa_g*(ALK - ALKbar) + pme*sALKbar ;

    F   = [eq1; eq2; eq3; eq4; eq5];

    if nargout > 1
        % construct the LHS matrix for the offline model
        % disp('Preparing LHS and RHS matrix:')
        % colum 1 dFdDIC
        Jc{1,1} = TRdiv - G_dic ;
        Jc{2,1} = 0*I ;
        Jc{3,1} = 0*I ;
        Jc{4,1} = 0*I ;
        Jc{5,1} = 0*I ;
        % colum 2 dFdPOC
        Jc{1,2} = 0*I ;
        Jc{2,2} = PFDc + kappa_p*I ;
        Jc{3,2} = -kappa_p*I ;
        Jc{4,2} = 0*I ;
        Jc{5,2} = 0*I ;
        % colum 3 dFdDOC
        Jc{1,3} = -kC ;
        Jc{2,3} = 0*I ;
        Jc{3,3} = TRdiv + kC ;
        Jc{4,3} = 0*I ;
        Jc{5,3} = N2C*kC ;
        % colum 4 dFdPIC
        Jc{1,4} = -kPIC*I ;
        Jc{2,4} = 0*I ;
        Jc{3,4} = 0*I ;
        Jc{4,4} = PFDa + kPIC*I ;
        Jc{5,4} = -2*kPIC*I ;
        % column 5 dFdALK
        Jc{1,5} = -G_alk ;
        Jc{2,5} = 0*I ;
        Jc{3,5} = 0*I ;
        Jc{4,5} = 0*I ;
        Jc{5,5} = TRdiv - kappa_g*I ;
        % factorize Jacobian matrix
        FD = mfactor(cell2mat(Jc)) ;
    end

    if (par.optim == off)
        Cx = [];
    elseif (par.optim & nargout > 2)
        pindx = par.pindx ;
        Z = sparse(nwet,1);
        C2P_cc = -PO4./(cc*PO4 + dd).^2;
        C2P_dd = -1./(cc*PO4 + dd).^2;
        par.C2P_cc = C2P_cc;
        par.C2P_dd = C2P_dd;
        [~,Gx] = uptake_C(par);
        par.Gx = Gx;
        npx    = par.npx;
		ncx    = par.ncx;
		nbx    = par.nbx;
		if par.Cellmodel == on  %(using eqC2Puptake)
			C2Px   = par.C2Px;
			%C2Pxx  = par.C2Pxx;
		end

        % P model parameters
        % sigma
        if (par.opt_sigma == on)
			%old version:
            % tmp = [sigma*RR*G*C2P  ; ...
            %        -sigma*G*C2P    ; ...
            %        sigma*G*C2P     ; ...
            %        -sigma*RR*G*C2P ; ...
            %        2*sigma*RR*G*C2P] + ...
            %       [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*C2P; ...
            %        (1-sigma)*d0(Gx(:,pindx.lsigma))*C2P; ...
            %        sigma*d0(Gx(:,pindx.lsigma))*C2P; ...
            %        d0((1-sigma)*RR*Gx(:,pindx.lsigma))*C2P; ...
            %        d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*C2P + ...
            %        d0(N2C*Gx(:,pindx.lsigma))*C2P] ;
			%new:
			tmp = [sigma*RR*G*C2P  ; ...
                   -sigma*G*C2P    ; ...
                   sigma*G*C2P     ; ...
                   -sigma*RR*G*C2P ; ...
                   2*sigma*RR*G*C2P] + ...
                  [-(I+(1-sigma)*RR)*(d0(Gx(:,pindx.lsigma))*C2P + G*C2Px(:,pindx.lsigma)); ...
                   (1-sigma)*(d0(Gx(:,pindx.lsigma))*C2P + G*C2Px(:,pindx.lsigma)); ...
                   sigma*(d0(Gx(:,pindx.lsigma))*C2P + G*C2Px(:,pindx.lsigma)); ...
                   (1-sigma)*RR*(d0(Gx(:,pindx.lsigma))*C2P + G*C2Px(:,pindx.lsigma)); ...
                   -2*(1-sigma)*RR*(d0(Gx(:,pindx.lsigma))*C2P + G*C2Px(:,pindx.lsigma)) + ...
                   N2C*(d0(Gx(:,pindx.lsigma))*C2P + G*C2Px(:,pindx.lsigma)) ] ;

            Cx(:,pindx.lsigma) = mfactor(FD, tmp)  ;

			% eq1 = (I+(1-sigma)*RR)*(G*C2P)  			;
			% eq2 = -(1-sigma)*G*C2P						;
			% eq3 = -sigma*(G*C2P) 							;
			% eq4 = -(1-sigma)*RR*(G*C2P) 			      ;
			% eq5 = 2*(1-sigma)*RR*(G*C2P) - N2C.*(G*C2P) ;

		% trying to find the error in sigma
%{
			 tmp_dC2Pexpl = real(C2Px(:,pindx.lsigma));
			 tmp_dC2Pcmplx = imag(C2P)/eps.^3;
			 fprintf('C2Px(:,pindx.lsigma) = %3.5e \n', max(tmp_dC2Pexpl,[],'all'))
			 fprintf('complex step: %3.5e \n', max(tmp_dC2Pcmplx,[],'all'))
			 fprintf('dC2P_dsigma relative error: %3.5e \n', max(abs((tmp_dC2Pexpl - tmp_dC2Pcmplx)./tmp_dC2Pcmplx),[],'all'))

			 tmp_dGcmplx = full(imag(diag(G)))/eps.^3;
			 fprintf('Gx(:,pindx.lsigma) = %3.5e \n', max(real(Gx(:,pindx.lsigma))))
	 		 fprintf('complex step of G: %3.5e \n', max(tmp_dGcmplx))
	 		 diff = max(abs((real(Gx(:,pindx.lsigma)) - tmp_dGcmplx)./tmp_dGcmplx),[],'all');
	 		 fprintf('dG_dsigma relative error = %3.5e  \n',diff);
%}
        end

        % kP_T
        if (par.opt_kP_T == on)
			%old version:
             % tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*C2P; ...
             %        (1-sigma)*d0(Gx(:,pindx.kP_T))*C2P; ...
             %        sigma*d0(Gx(:,pindx.kP_T))*C2P; ...
             %        d0((1-sigma)*RR*Gx(:,pindx.kP_T))*C2P; ...
             %        d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*C2P + ...
             %        d0(N2C*Gx(:,pindx.kP_T))*C2P];
			%new:
	   		tmp = [-(I+(1-sigma)*RR)*(d0(Gx(:,pindx.kP_T))*C2P + G*C2Px(:,pindx.kP_T)); ... %does it need to be d0(G) ? = no
		 		  (1-sigma)*(d0(Gx(:,pindx.kP_T))*C2P + G*C2Px(:,pindx.kP_T)); ...
				  sigma*(d0(Gx(:,pindx.kP_T))*C2P + G*C2Px(:,pindx.kP_T)); ...
				  (1-sigma)*RR*(d0(Gx(:,pindx.kP_T))*C2P + G*C2Px(:,pindx.kP_T)); ...
				  -2*(1-sigma)*RR*(d0(Gx(:,pindx.kP_T))*C2P + G*C2Px(:,pindx.kP_T)) + ...
				  N2C*(d0(Gx(:,pindx.kP_T))*C2P + G*C2Px(:,pindx.kP_T))];

            Cx(:,pindx.kP_T) = mfactor(FD, tmp);
        end

        % kdP
        if (par.opt_kdP == on)
            % tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*C2P; ...
            %        (1-sigma)*d0(Gx(:,pindx.lkdP))*C2P; ...
            %        sigma*d0(Gx(:,pindx.lkdP))*C2P; ...
            %        d0((1-sigma)*RR*Gx(:,pindx.lkdP))*C2P; ...
            %        d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*C2P + ...
            %        d0(N2C*Gx(:,pindx.lkdP))*C2P];
			tmp = [-(I+(1-sigma)*RR)*(d0(Gx(:,pindx.lkdP))*C2P+ G*C2Px(:,pindx.lkdP)); ...
                   (1-sigma)*(d0(Gx(:,pindx.lkdP))*C2P + G*C2Px(:,pindx.lkdP)); ...
                   sigma*(d0(Gx(:,pindx.lkdP))*C2P + G*C2Px(:,pindx.lkdP)); ...
                   (1-sigma)*RR*(d0(Gx(:,pindx.lkdP))*C2P + G*C2Px(:,pindx.lkdP)); ...
                   -2*(1-sigma)*RR*(d0(Gx(:,pindx.lkdP))*C2P + G*C2Px(:,pindx.lkdP)) + ...
                   N2C*(d0(Gx(:,pindx.lkdP))*C2P + G*C2Px(:,pindx.lkdP))];

            Cx(:,pindx.lkdP) = mfactor(FD, tmp);
        end

        % bP_T
        if (par.opt_bP_T == on)
            % tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*C2P; ...
            %        (1-sigma)*d0(Gx(:,pindx.bP_T))*C2P; ...
            %        sigma*d0(Gx(:,pindx.bP_T))*C2P; ...
            %        d0((1-sigma)*RR*Gx(:,pindx.bP_T))*C2P; ...
            %        d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*C2P + ...
            %        d0(N2C*Gx(:,pindx.bP_T))*C2P];
			tmp = [-(I+(1-sigma)*RR)*(d0(Gx(:,pindx.bP_T))*C2P + G*C2Px(:,pindx.bP_T)); ...
		 		  (1-sigma)*(d0(Gx(:,pindx.bP_T))*C2P + G*C2Px(:,pindx.bP_T)); ...
				  sigma*(d0(Gx(:,pindx.bP_T))*C2P + G*C2Px(:,pindx.bP_T)); ...
				  (1-sigma)*RR*(d0(Gx(:,pindx.bP_T))*C2P + G*C2Px(:,pindx.bP_T)); ...
				  -2*(1-sigma)*RR*(d0(Gx(:,pindx.bP_T))*C2P + G*C2Px(:,pindx.bP_T)) + ...
				  N2C*(d0(Gx(:,pindx.bP_T))*C2P + G*C2Px(:,pindx.bP_T))];

            Cx(:,pindx.bP_T) = mfactor(FD, tmp);
        end

        % bP
        if (par.opt_bP == on)
            % tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*C2P;...
            %        (1-sigma)*d0(Gx(:,pindx.lbP))*C2P;...
            %        sigma*d0(Gx(:,pindx.lbP))*C2P;...
            %        d0((1-sigma)*RR*Gx(:,pindx.lbP))*C2P; ...
            %        d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*C2P + ...
            %        d0(N2C*Gx(:,pindx.lbP))*C2P];
			tmp = [-(I+(1-sigma)*RR)*(d0(Gx(:,pindx.lbP))*C2P + G*C2Px(:,pindx.lbP)); ...
		 		  (1-sigma)*(d0(Gx(:,pindx.lbP))*C2P + G*C2Px(:,pindx.lbP)); ...
				  sigma*(d0(Gx(:,pindx.lbP))*C2P + G*C2Px(:,pindx.lbP)); ...
				  (1-sigma)*RR*(d0(Gx(:,pindx.lbP))*C2P + G*C2Px(:,pindx.lbP)); ...
				  -2*(1-sigma)*RR*(d0(Gx(:,pindx.lbP))*C2P + G*C2Px(:,pindx.lbP)) + ...
				  N2C*(d0(Gx(:,pindx.lbP))*C2P + G*C2Px(:,pindx.lbP))];

            Cx(:,pindx.lbP) = mfactor(FD, tmp);
        end

        % alpha
        if (par.opt_alpha == on)
            % tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*C2P; ...
            %        (1-sigma)*d0(Gx(:,pindx.lalpha))*C2P; ...
            %        sigma*d0(Gx(:,pindx.lalpha))*C2P; ...
            %        d0((1-sigma)*RR*Gx(:,pindx.lalpha))*C2P; ...
            %        d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*C2P + ...
            %        d0(N2C*Gx(:,pindx.lalpha))*C2P];
			tmp = [-(I+(1-sigma)*RR)*(d0(Gx(:,pindx.lalpha))*C2P + G*C2Px(:,pindx.lalpha)); ...
		 		  (1-sigma)*(d0(Gx(:,pindx.lalpha))*C2P + G*C2Px(:,pindx.lalpha)); ...
				  sigma*(d0(Gx(:,pindx.lalpha))*C2P + G*C2Px(:,pindx.lalpha)); ...
				  (1-sigma)*RR*(d0(Gx(:,pindx.lalpha))*C2P + G*C2Px(:,pindx.lalpha)); ...
				  -2*(1-sigma)*RR*(d0(Gx(:,pindx.lalpha))*C2P + G*C2Px(:,pindx.lalpha)) + ...
				  N2C*(d0(Gx(:,pindx.lalpha))*C2P + G*C2Px(:,pindx.lalpha))];

            Cx(:,pindx.lalpha) = mfactor(FD, tmp);
        end

        % beta
        if (par.opt_beta == on)
            % tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*C2P;...
            %        (1-sigma)*d0(Gx(:,pindx.lbeta))*C2P;...
            %        sigma*d0(Gx(:,pindx.lbeta))*C2P;...
            %        d0((1-sigma)*RR*Gx(:,pindx.lbeta))*C2P; ...
            %        d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*C2P + ...
            %        d0(N2C*Gx(:,pindx.lbeta))*C2P];
			tmp = [-(I+(1-sigma)*RR)*(d0(Gx(:,pindx.lbeta))*C2P + G*C2Px(:,pindx.lbeta)); ...
		 		  (1-sigma)*(d0(Gx(:,pindx.lbeta))*C2P + G*C2Px(:,pindx.lbeta)); ...
				  sigma*(d0(Gx(:,pindx.lbeta))*C2P + G*C2Px(:,pindx.lbeta)); ...
				  (1-sigma)*RR*(d0(Gx(:,pindx.lbeta))*C2P + G*C2Px(:,pindx.lbeta)); ...
				  -2*(1-sigma)*RR*(d0(Gx(:,pindx.lbeta))*C2P + G*C2Px(:,pindx.lbeta)) + ...
				  N2C*(d0(Gx(:,pindx.lbeta))*C2P + G*C2Px(:,pindx.lbeta))];

            Cx(:,pindx.lbeta) = mfactor(FD, tmp);
        end
        % -------------------- C parameters ------------------
        % bC_T
        if (par.opt_bC_T == on)
            [~,Gout]   = buildPFD(par,'POC');
            PFD_bm     = Gout.PFD_bm;
            par.PFD_bm = PFD_bm;
            tmp = [Z; -PFD_bm*POC; Z;  Z; Z];

            Cx(:,pindx.bC_T) = mfactor(FD, tmp);
        end

        % bC
        if (par.opt_bC == on)
            [~,Gout]   = buildPFD(par,'POC');
            PFD_bb     = Gout.PFD_bb;
            par.PFD_bb = PFD_bb;
            tmp = bC*[Z; -PFD_bb*POC; Z; Z; Z];

            Cx(:,pindx.lbC) = mfactor(FD, tmp);
        end

        % d
        if (par.opt_d == on)
            [~,Gout]  = buildPFD(par,'PIC');
            PFD_d     = Gout.PFD_d;
            par.PFD_d = PFD_d;
            tmp = d*[Z; Z; Z; -PFD_d*PIC; Z];

            Cx(:,pindx.ld) = mfactor(FD, tmp);
        end

        % kC_T
        if (par.opt_kC_T == on)
            kC_kC_T     = d0(Tz) ;
            par.kC_kC_T = kC_kC_T ;
            tmp = [kC_kC_T*DOC; ...
                   Z; ...
                   -kC_kC_T*DOC; ...
                   Z; ...
                   -N2C*kC_kC_T*DOC];

            Cx(:,pindx.kC_T) = mfactor(FD, tmp);
        end

        % kdC
        if (par.opt_kdC == on)
            kC_kdC     = kdC ;
            par.kC_kdC = kC_kdC;
            tmp = kC_kdC*[DOC; Z; -DOC; Z; -N2C*DOC];

            Cx(:,pindx.lkdC) = mfactor(FD, tmp);
        end

        % R_Si
        if (par.opt_R_Si == on)
            tmp = [-(1-sigma)*RR_Si*(G*C2P); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*(G*C2P); ...
                   -2*(1-sigma)*RR_Si*(G*C2P)];

            Cx(:,pindx.R_Si) = mfactor(FD, tmp);
        end

        % rR
        if (par.opt_rR == on)
            tmp = [-(1-sigma)*RR_rR*(G*C2P); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*C2P); ...
                   -2*(1-sigma)*RR_rR*(G*C2P)];

            Cx(:,pindx.lrR) = mfactor(FD, tmp);
        end

        % cc
        if (par.opt_cc == on)
            tmp = cc*[-(I+(1-sigma)*RR)*(G*C2P_cc); ...
                      (1-sigma)*G*C2P_cc; ...
                      sigma*G*C2P_cc; ...
                      (1-sigma)*RR*(G*C2P_cc); ...
                      -2*(1-sigma)*RR*(G*C2P_cc) + ...
                      N2C*G*C2P_cc];

            Cx(:,pindx.lcc) = mfactor(FD, tmp);
        end

        % dd
        if (par.opt_dd == on)
            tmp = dd*[-(I+(1-sigma)*RR)*(G*C2P_dd); ...
                      (1-sigma)*G*C2P_dd; ...
                      sigma*G*C2P_dd; ...
                      (1-sigma)*RR*(G*C2P_dd); ...
                      -2*(1-sigma)*RR*(G*C2P_dd) + ...
                      N2C*G*C2P_dd];

            Cx(:,pindx.ldd) = mfactor(FD, tmp);
        end

		% -------------------- CellModel parameters ------------------
		%  Q10Photo
		if (par.opt_Q10Photo == on)
        	C2P_Q10 = par.CellOut.dC2P_dQ10Photo(iwet); % =C2Px(:,par.pindx.lQ10Photo); % same thing saved 2 ways, switching to C2Px notation
			dQ10_lQ10Photo = par.BIO.Q10Photo;
			tmp = dQ10_lQ10Photo*[-(I+(1-sigma)*RR)*(G*C2P_Q10); ...
                      (1-sigma)*G*C2P_Q10; ...
                      sigma*G*C2P_Q10; ...
                      (1-sigma)*RR*(G*C2P_Q10); ...
                      -2*(1-sigma)*RR*(G*C2P_Q10) + ...
                      N2C*G*C2P_Q10];
        	Cx(:,pindx.lQ10Photo) = mfactor(FD, tmp);
    	end
		%  fStorage
		if (par.opt_fStorage == on)
        	C2P_fStor = par.CellOut.dC2P_dfStorage(iwet); % =C2Px(:,par.pindx.lfStorage);
			dfStor_lfStorage = par.BIO.fStorage;
			tmp = dfStor_lfStorage*[-(I+(1-sigma)*RR)*(G*C2P_fStor); ...
                      (1-sigma)*G*C2P_fStor; ...
                      sigma*G*C2P_fStor; ...
                      (1-sigma)*RR*(G*C2P_fStor); ...
                      -2*(1-sigma)*RR*(G*C2P_fStor) + ...
                      N2C*G*C2P_fStor];
        	Cx(:,pindx.lfStorage) = mfactor(FD, tmp);
    	end
		%  fRibE
		if (par.opt_fRibE == on)
        	C2P_fRibE = par.CellOut.dC2P_dfRibE(iwet); % = C2Px(:,par.pindx.tfRibE);
			tfRibE = atanh(2*par.BIO.fRibE-1);
			dfRibE_tfRibE = 0.5*sech(tfRibE)^2; 	% dfRibE/dtfRibE = 0.5*sech(tfRibE)^2
			%C2P_tfRibE = C2P_fRibE*dfRibE_dtfRibE;
			tmp = dfRibE_tfRibE*[-(I+(1-sigma)*RR)*(G*C2P_fRibE); ...
                      (1-sigma)*G*C2P_fRibE; ...
                      sigma*G*C2P_fRibE; ...
                      (1-sigma)*RR*(G*C2P_fRibE); ...
                      -2*(1-sigma)*RR*(G*C2P_fRibE) + ...
                      N2C*G*C2P_fRibE];
        	Cx(:,pindx.tfRibE) = mfactor(FD, tmp);
    	end
		%  kST0
		if (par.opt_kST0 == on)
        	C2P_kST0 = par.CellOut.dC2P_dkST0(iwet); % = C2Px(:,par.pindx.lkST0);
			dkST0_lkST0 = par.BIO.kST0;
			C2Ptmp = C2P_kST0*dkST0_lkST0;
			tmp = [-(I+(1-sigma)*RR)*(G*C2Ptmp); ...
                      (1-sigma)*G*C2Ptmp; ...
                      sigma*G*C2Ptmp; ...
                      (1-sigma)*RR*(G*C2Ptmp); ...
                      -2*(1-sigma)*RR*(G*C2Ptmp) + ...
                      N2C*G*C2Ptmp];
        	Cx(:,pindx.lkST0) = mfactor(FD, tmp);
    	end
		%  PLip_PCutoff
		if (par.opt_PLip_PCutoff == on)
        	C2P_PCutoff = par.CellOut.dC2P_dPCutoff(iwet); % = C2Px(:,par.pindx.lPLip_PCutoff);
			dPCutoff_lPCutoff = par.BIO.PLip_PCutoff;
			tmp = dPCutoff_lPCutoff*[-(I+(1-sigma)*RR)*(G*C2P_PCutoff); ...
                      (1-sigma)*G*C2P_PCutoff; ...
                      sigma*G*C2P_PCutoff; ...
                      (1-sigma)*RR*(G*C2P_PCutoff); ...
                      -2*(1-sigma)*RR*(G*C2P_PCutoff) + ...
                      N2C*G*C2P_PCutoff];
        	Cx(:,pindx.lPLip_PCutoff) = mfactor(FD, tmp);
    	end
		% opt_PLip_scale
		if (par.opt_PLip_scale == on)
        	C2P_PLipscale = par.CellOut.dC2P_dPLip_scale(iwet); % =C2Px(:,par.pindx.lPLip_scale);
			dPLipscale_lPLipscale = par.BIO.PLip_scale;
			tmp = dPLipscale_lPLipscale*[-(I+(1-sigma)*RR)*(G*C2P_PLipscale); ...
                      (1-sigma)*G*C2P_PLipscale; ...
                      sigma*G*C2P_PLipscale; ...
                      (1-sigma)*RR*(G*C2P_PLipscale); ...
                      -2*(1-sigma)*RR*(G*C2P_PLipscale) + ...
                      N2C*G*C2P_PLipscale];
        	Cx(:,pindx.lPLip_scale) = mfactor(FD, tmp);
    	end
		%  PStor_rCutoff
		if (par.opt_PStor_rCutoff == on)
        	C2P_rCutoff = par.CellOut.dC2P_drCutoff(iwet); % =C2Px(:,par.pindx.lPStor_rCutoff);
			drCutoff_lrCutoff = par.BIO.PStor_rCutoff;
			tmp = drCutoff_lrCutoff*[-(I+(1-sigma)*RR)*(G*C2P_rCutoff); ...
                      (1-sigma)*G*C2P_rCutoff; ...
                      sigma*G*C2P_rCutoff; ...
                      (1-sigma)*RR*(G*C2P_rCutoff); ...
                      -2*(1-sigma)*RR*(G*C2P_rCutoff) + ...
                      N2C*G*C2P_rCutoff];
        	Cx(:,pindx.lPStor_rCutoff) = mfactor(FD, tmp);
    	end
		%  PStor_scale
		if (par.opt_PStor_scale == on)
        	C2P_PStorscale = par.CellOut.dC2P_dPStor_scale(iwet); % =C2Px(:,par.pindx.lPStor_scale);
			dPStorscale_lPStorscale = par.BIO.PStor_scale;
			tmp = dPStorscale_lPStorscale*[-(I+(1-sigma)*RR)*(G*C2P_PStorscale); ...
                      (1-sigma)*G*C2P_PStorscale; ...
                      sigma*G*C2P_PStorscale; ...
                      (1-sigma)*RR*(G*C2P_PStorscale); ...
                      -2*(1-sigma)*RR*(G*C2P_PStorscale) + ...
                      N2C*G*C2P_PStorscale];
        	Cx(:,pindx.lPStor_scale) = mfactor(FD, tmp);
    	end
		% par.opt_alphaS
		if (par.opt_alphaS == on)
        	C2P_alphaS = par.CellOut.dC2P_dalphaS(iwet); % =C2Px(:,par.pindx.lalphaS);
			dalphaS_lalphaS = par.BIO.alphaS;
			tmp = dalphaS_lalphaS*[-(I+(1-sigma)*RR)*(G*C2P_alphaS); ...
                      (1-sigma)*G*C2P_alphaS; ...
                      sigma*G*C2P_alphaS; ...
                      (1-sigma)*RR*(G*C2P_alphaS); ...
                      -2*(1-sigma)*RR*(G*C2P_alphaS) + ...
                      N2C*G*C2P_alphaS];
        	Cx(:,pindx.lalphaS) = mfactor(FD, tmp);
    	end

    end %  end Jacobian

    if (par.optim == off)
        Cxx = [];
    elseif (par.optim & nargout > 3);
        p2c       = cc*PO4 + dd;
        C2P_dd_dd = 2./p2c.^3;
        C2P_cc_cc = (2*PO4.^2)./p2c.^3;
        C2P_cc_dd = (2*PO4)./p2c.^3;
%{
		if (par.Cellmodel & par.opt_Q10Photo)
			C2P_Q10 = par.CellOut.dC2P_dQ10Photo(iwet);
		end
		if (par.Cellmodel & par.opt_fStorage)
			C2P_fStor = par.CellOut.dC2P_dfStorage(iwet);
		end
%}
        [~,~,Gxx] = uptake_C(par);
        par.Gxx   = Gxx;
		if par.Cellmodel ==on %(using eqC2Puptake)
			C2Pxx  = par.C2Pxx;
			C2Ppxx = par.C2Ppxx;
		end
        DICx = Cx(0*nwet+1:1*nwet,:);
        POCx = Cx(1*nwet+1:2*nwet,:);
        DOCx = Cx(2*nwet+1:3*nwet,:);
        PICx = Cx(3*nwet+1:4*nwet,:);
        ALKx = Cx(4*nwet+1:5*nwet,:);
        % ------------------------------------------------------
        % P model only parameters
        kk = 0;
        for jj = 1:npx
            for jk = jj:npx
                kk = kk + 1;
                if (par.opt_sigma == on)
                    % sigma sigma %% HAS NOT BEEN UPDATED
                    if (jj == jk & jj == pindx.lsigma)
                        tmp = sigma*[RR*G*C2P + 2*d0(RR*Gx(:,jj))*C2P; ...
                                     -G*C2P - 2*d0(Gx(:,jj))*C2P;...
                                      G*C2P + 2*d0(Gx(:,jj))*C2P;...
                                     -RR*G*C2P - 2*d0(RR*Gx(:,jj))*C2P; ...
                                     2*RR*G*C2P + 2*2*d0(RR*Gx(:,jj))*C2P] + ...
                              [-d0((I+(1-sigma)*RR)*Gxx(:,kk))*C2P; ...
                               (1-sigma)*d0(Gxx(:,kk))*C2P; ...
                               sigma*d0(Gxx(:,kk))*C2P; ...
                               d0((1-sigma)*RR*Gxx(:,kk))*C2P; ...
                               d0(-2*(1-sigma)*RR*Gxx(:,kk))*C2P + ...
                               d0(N2C*Gxx(:,kk))*C2P];

                        Cxx(:,kk) = mfactor(FD, tmp);
                        %pairs not assciated with sigma;
                    elseif (jj ~= pindx.lsigma & jk ~= pindx.lsigma)
                        % tmp = [-d0((I+(1-sigma)*RR)*Gxx(:,kk))*C2P; ...
                        %        (1-sigma)*d0(Gxx(:,kk))*C2P; ...
                        %        sigma*d0(Gxx(:,kk))*C2P; ...
                        %        d0((1-sigma)*RR*Gxx(:,kk))*C2P; ...
                        %        d0(-2*(1-sigma)*RR*Gxx(:,kk))*C2P + ...
                        %        d0(N2C*Gxx(:,kk))*C2P];
						tmp = [-(I+(1-sigma)*RR)*(d0(Gxx(:,kk))*C2P +G*C2Ppxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
								(1-sigma)*(d0(Gxx(:,kk))*C2P +G*C2Ppxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
								sigma*(d0(Gxx(:,kk))*C2P +G*C2Ppxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
								(1-sigma)*RR*(d0(Gxx(:,kk))*C2P +G*C2Ppxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
								-2*(1-sigma)*RR*(d0(Gxx(:,kk))*C2P +G*C2Ppxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)) + ...
								N2C*(d0(Gxx(:,kk))*C2P +G*C2Ppxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj))];

                        Cxx(:,kk) = mfactor(FD, tmp);

                    else
                        % tmp = [RR*sigma*d0(Gx(:,jk))*C2P; ...
                        %        -sigma*d0(Gx(:,jk))*C2P; ...
                        %        sigma*d0(Gx(:,jk))*C2P; ...
                        %        -RR*sigma*d0(Gx(:,jk))*C2P; ...
                        %        2*RR*sigma*d0(Gx(:,jk))*C2P] + ...
                        %       [-d0((I+(1-sigma)*RR)*Gxx(:,kk))*C2P; ...
                        %        (1-sigma)*d0(Gxx(:,kk))*C2P; ...
                        %        sigma*d0(Gxx(:,kk))*C2P; ...
                        %        d0((1-sigma)*RR*Gxx(:,kk))*C2P;...
                        %        d0(-2*(1-sigma)*RR*Gxx(:,kk))*C2P + ...
                        %        d0(N2C*Gxx(:,kk))*C2P];

						tmp = [RR*sigma*(d0(Gx(:,jk))*C2P + G*C2Px(:,jk)); ...
                               -sigma*(d0(Gx(:,jk))*C2P + G*C2Px(:,jk)); ...
                               sigma*(d0(Gx(:,jk))*C2P + G*C2Px(:,jk)); ...
                               -RR*sigma*(d0(Gx(:,jk))*C2P + G*C2Px(:,jk)); ...
                               2*RR*sigma*(d0(Gx(:,jk))*C2P + G*C2Px(:,jk))] + ...
                              [-(I+(1-sigma)*RR)*(d0(Gxx(:,kk))*C2P + G*C2Ppxx(:,kk) + d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
                               (1-sigma)*(d0(Gxx(:,kk))*C2P + G*C2Ppxx(:,kk) + d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
                               sigma*(d0(Gxx(:,kk))*C2P + G*C2Ppxx(:,kk) + d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
                               (1-sigma)*RR*(d0(Gxx(:,kk))*C2P + G*C2Ppxx(:,kk) + d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj));...
                               -2*(1-sigma)*RR*(d0(Gxx(:,kk))*C2P + G*C2Ppxx(:,kk) + d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)) + ...
                               N2C*(d0(Gxx(:,kk))*C2P + G*C2Ppxx(:,kk) + d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)) ];

                        Cxx(:,kk) = mfactor(FD, tmp);

						% eq1 = (I+(1-sigma)*RR)*(G*C2P)  			;
					    % eq2 = -(1-sigma)*G*C2P						;
					    % eq3 = -sigma*G*C2P 							;
					    % eq4 = -(1-sigma)*RR*(G*C2P) 			    ;
					    % eq5 = 2*(1-sigma)*RR*(G*C2P) - N2C.*(G*C2P) ;

						% until I figure out why dC_dsigma is wrong, all the hessian values involving sigma will be wrong too
						% using eq3 as an example, bc its the simplest:
%%%%						Cx3  = sigma*G*C2P + sigma*d0(Gx(:,pindx.lsigma))*C2P + sigma*G*C2Px(:,pindx.lsigma)
%%%%						Cx3  = sigma*G*C2P + sigma*( d0(Gx(:,pindx.lsigma))*C2P + G*C2Px(:,pindx.lsigma) )
%%%%						Cxx3 = sigma*(d0(Gx(:,jk))*C2P + G*C2Px(:,jk)) + sigma* ( d0(Gxx(:,kk))*C2P + d0(Gx(:,kk)*C2Px(:,kk)) ...
%%%%								+ d0(Gx(:,kk))*C2Px(:,kk) + G*C2Pxx(:,kk) )
%%%%						Cxx3 = sigma*(d0(Gx(:,jk))*C2P + G*C2Px(:,jk)) + ...
%									sigma*(d0(Gxx(:,kk))*C2P + G*C2Pxx(:,kk) + 2*d0(Gx(:,kk))*C2Px(:,kk) )

						% % old:
						% Cx3  = sigma*G*C2P + sigma*d0(Gx(:,pindx.lsigma))*C2P
						% % if d2C_dsigma2
						% = sigma*G*C2P + sigma*d0(Gx(:,pindx.lsigma))*C2P + sigma*d0(Gx(:,jk))*C2P + sigma*d0(Gxx(:,kk))*C2P;
						% = sigma * (G*C2P + 2*d0(Gx(:,jk))*C2P + d0(Gxx(:,kk))*C2P)
						% Cxx3 = sigma* (G*C2P + 2*d0(Gx(:,jj))*C2P) + sigma*d0(Gxx(:,kk))*C2P
						% % if dC_dsigma_d___
						% Cxx3 = sigma*d0(Gx(:,jk))*C2P + sigma*d0(Gxx(:,kk))*C2P;
                    end
                else
                    % tmp = [-d0((I+(1-sigma)*RR)*Gxx(:,kk))*C2P; ...
                    %        (1-sigma)*d0(Gxx(:,kk))*C2P; ...
                    %        sigma*d0(Gxx(:,kk))*C2P; ...
                    %        d0((1-sigma)*RR*Gxx(:,kk))*C2P; ...
                    %        d0(-2*(1-sigma)*RR*Gxx(:,kk))*C2P + ...
                    %        d0(N2C*Gxx(:,kk))*C2P];
					tmp = [-(I+(1-sigma)*RR)*(d0(Gxx(:,kk))*C2P +G*C2Pxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
							(1-sigma)*(d0(Gxx(:,kk))*C2P +G*C2Pxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
							sigma*(d0(Gxx(:,kk))*C2P +G*C2Pxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
							(1-sigma)*RR*(d0(Gxx(:,kk))*C2P +G*C2Pxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)); ...
							-2*(1*sigma)*RR*(d0(Gxx(:,kk))*C2P +G*C2Pxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)) + ...
							N2C*(d0(Gxx(:,kk))*C2P +G*C2Pxx(:,kk) +d0(Gx(:,jj))*C2Px(:,jk)+d0(Gx(:,jk))*C2Px(:,jj)) ];

                    Cxx(:,kk) = mfactor(FD, tmp);
                    % sigma foo
                end
            end
        end
        % ------------------------------------------------------
        %%% P and  C model parameters
        % sigma bC_T
        if (par.opt_sigma & par.opt_bC_T)
            kk  = kk + 1;
            tmp =  [Z; ...
                    -PFD_bm*POCx(:,pindx.lsigma) ; ...
                    Z; ...
                    Z; ...
                    Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % sigma bC
        if (par.opt_sigma & par.opt_bC)
            kk = kk + 1;
            tmp =  [Z ; ...
                    -bC*PFD_bb*POCx(:,pindx.lsigma); ...
                    Z ; ...
                    Z ; ...
                    Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % sigma d
        if (par.opt_sigma & par.opt_d)
            kk = kk + 1;
            tmp = [Z ; ...
                   Z ; ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.lsigma); ...
                   Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % sigma kC_T
        if (par.opt_sigma & par.opt_kC_T)
            kk  = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lsigma); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lsigma); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lsigma)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % sigma kdC
        if (par.opt_sigma & par.opt_kdC)
            kk  = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.lsigma); ...
                   Z; ...
                   -kC_kdC*DOCx(:,pindx.lsigma); ...
                   Z; ...
                   -N2C*kC_kdC*DOCx(:,pindx.lsigma)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % sigma R_Si
        if (par.opt_sigma & par.opt_R_Si)
            kk = kk + 1;
            tmp = [sigma*RR_Si*G*C2P ; ...
                   Z ; ...
                   Z ; ...
                   -sigma*RR_Si*G*C2P; ...
                   2*sigma*RR_Si*G*C2P] + ...
                  [-d0((1-sigma)*RR_Si*Gx(:,pindx.lsigma))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_Si*Gx(:,pindx.lsigma))*C2P; ...
                   d0(-2*(1-sigma)*RR_Si*Gx(:,pindx.lsigma))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % sigma rR
        if (par.opt_sigma & par.opt_rR)
            kk = kk + 1;
            tmp = [sigma*RR_rR*G*C2P ; ...
                   Z ; ...
                   Z ; ...
                   -sigma*RR_rR*G*C2P; ...
                   2*sigma*RR_rR*G*C2P] + ...
                  [-d0((1-sigma)*RR_rR*Gx(:,pindx.lsigma))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_rR*Gx(:,pindx.lsigma))*C2P; ...
                   d0(-2*(1-sigma)*RR_rR*Gx(:,pindx.lsigma))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % sigma cc
        if (par.opt_sigma & par.opt_cc)
            kk  = kk + 1;
            tmp = cc*[RR*sigma*G*C2P_cc; ...
                      -sigma*G*C2P_cc; ...
                      sigma*G*C2P_cc; ...
                      -RR*sigma*G*C2P_cc; ...
                      2*RR*sigma*G*C2P_cc] + ...
                  cc*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*C2P_cc; ...
                      (1-sigma)*d0(Gx(:,pindx.lsigma))*C2P_cc; ...
                      sigma*d0(Gx(:,pindx.lsigma))*C2P_cc; ...
                      d0((1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_cc; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_cc + ...
                      d0(N2C*Gx(:,pindx.lsigma))*C2P_cc];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % sigma dd
        if (par.opt_sigma & par.opt_dd)
            kk  = kk + 1;
            tmp = dd*[RR*sigma*G*C2P_dd; ...
                      -sigma*G*C2P_dd; ...
                      sigma*G*C2P_dd; ...
                      -RR*sigma*G*C2P_dd; ...
                      2*RR*sigma*G*C2P_dd] + ...
                  dd*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*C2P_dd; ...
                      (1-sigma)*d0(Gx(:,pindx.lsigma))*C2P_dd; ...
                      sigma*d0(Gx(:,pindx.lsigma))*C2P_dd; ...
                      d0((1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_dd; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_dd + ...
                      d0(N2C*Gx(:,pindx.lsigma))*C2P_dd];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

%kP_T
        % kP_T bC_T
        if (par.opt_kP_T & par.opt_bC_T)
            kk  = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.kP_T); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kP_T bC
        if (par.opt_kP_T & par.opt_bC)
            kk = kk + 1;
            tmp = [Z ; ...
                   -bC*PFD_bb*POCx(:,pindx.kP_T); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kP_T d
        if (par.opt_kP_T & par.opt_d)
            kk = kk + 1;
            tmp = [Z ; ...
                   Z ; ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.kP_T); ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kP_T kC_T
        if (par.opt_kP_T & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.kP_T); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.kP_T); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.kP_T)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kP_T kdC
        if (par.opt_kP_T & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.kP_T); ...
                   Z ; ...
                   -kC_kdC*DOCx(:,pindx.kP_T); ...
                   Z ; ...
                   -N2C*kC_kdC*DOCx(:,pindx.kP_T)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kP_T R_Si
        if (par.opt_kP_T & par.opt_R_Si)
            kk = kk + 1;
            tmp = [-d0((1-sigma)*RR_Si*Gx(:,pindx.kP_T))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_Si*Gx(:,pindx.kP_T))*C2P; ...
                   d0(-2*(1-sigma)*RR_Si*Gx(:,pindx.kP_T))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kP_T RR_rR
        if (par.opt_kP_T & par.opt_rR)
            kk = kk + 1;
            tmp = [-d0((1-sigma)*RR_rR*Gx(:,pindx.kP_T))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_rR*Gx(:,pindx.kP_T))*C2P; ...
                   d0(-2*(1-sigma)*RR_rR*Gx(:,pindx.kP_T))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kP_T cc
        if (par.opt_kP_T & par.opt_cc)
            kk = kk + 1;
            tmp = cc*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*C2P_cc; ...
                      (1-sigma)*d0(Gx(:,pindx.kP_T))*C2P_cc; ...
                      sigma*d0(Gx(:,pindx.kP_T))*C2P_cc; ...
                      d0((1-sigma)*RR*Gx(:,pindx.kP_T))*C2P_cc; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*C2P_cc + ...
                      d0(N2C*Gx(:,pindx.kP_T))*C2P_cc];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kP_T dd
        if (par.opt_kP_T & par.opt_dd)
            kk = kk + 1;
            tmp = dd*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*C2P_dd; ...
                      (1-sigma)*d0(Gx(:,pindx.kP_T))*C2P_dd; ...
                      sigma*d0(Gx(:,pindx.kP_T))*C2P_dd; ...
                      d0((1-sigma)*RR*Gx(:,pindx.kP_T))*C2P_dd; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*C2P_dd + ...
                      d0(N2C*Gx(:,pindx.kP_T))*C2P_dd];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
	%kdP
        % kdP bC_T
        if (par.opt_kdP & par.opt_bC_T)
            kk = kk + 1;
            tmp =  [Z; ...
                    -PFD_bm*POCx(:,pindx.lkdP); ...
                    Z; ...
                    Z; ...
                    Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdP bC
        if (par.opt_kdP & par.opt_bC)
            kk = kk + 1;
            tmp = [Z ; ...
                   -bC*PFD_bb*POCx(:,pindx.lkdP); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdP d
        if (par.opt_kdP & par.opt_d)
            kk = kk + 1;
            tmp = [Z; ...
                   Z; ...
                   Z; ...
                   -d*PFD_d*PICx(:,pindx.lkdP); ...
                   Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdP kC_T
        if (par.opt_kdP & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lkdP); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lkdP); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lkdP)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdP kdC
        if (par.opt_kdP & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.lkdP); ...
                   Z ; ...
                   -kC_kdC*DOCx(:,pindx.lkdP); ...
                   Z; ...
                   -N2C*kC_kdC*DOCx(:,pindx.lkdP)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdP R_Si
        if (par.opt_kdP & par.opt_R_Si)
            kk  = kk + 1;
            tmp = [-d0((1-sigma)*RR_Si*Gx(:,pindx.lkdP))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_Si*Gx(:,pindx.lkdP))*C2P; ...
                   d0(-2*(1-sigma)*RR_Si*Gx(:,pindx.lkdP))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdP rR
        if (par.opt_kdP & par.opt_rR)
            kk  = kk + 1;
            tmp = [-d0((1-sigma)*RR_rR*Gx(:,pindx.lkdP))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_rR*Gx(:,pindx.lkdP))*C2P; ...
                   d0(-2*(1-sigma)*RR_rR*Gx(:,pindx.lkdP))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdP cc
        if (par.opt_kdP & par.opt_cc)
            kk  = kk + 1;
            tmp = cc*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*C2P_cc; ...
                      (1-sigma)*d0(Gx(:,pindx.lkdP))*C2P_cc; ...
                      sigma*d0(Gx(:,pindx.lkdP))*C2P_cc; ...
                      d0((1-sigma)*RR*Gx(:,pindx.lkdP))*C2P_cc; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*C2P_cc + ...
                      d0(N2C*Gx(:,pindx.lkdP))*C2P_cc];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdP dd
        if (par.opt_kdP & par.opt_dd)
            kk  = kk + 1;
            tmp = dd*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*C2P_dd; ...
                      (1-sigma)*d0(Gx(:,pindx.lkdP))*C2P_dd; ...
                      sigma*d0(Gx(:,pindx.lkdP))*C2P_dd; ...
                      d0((1-sigma)*RR*Gx(:,pindx.lkdP))*C2P_dd; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*C2P_dd + ...
                      d0(N2C*Gx(:,pindx.lkdP))*C2P_dd];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

%bP_T
        % bP_T bC_T
        if (par.opt_bP_T & par.opt_bC_T)
            kk  = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.bP_T); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP_T bC
        if (par.opt_bP_T & par.opt_bC)
            kk = kk + 1;
            tmp = [Z ; ...
                   -bC*PFD_bb*POCx(:,pindx.bP_T); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP_T d
        if (par.opt_bP_T & par.opt_d)
            kk = kk + 1;
            tmp = [Z ; ...
                   Z ; ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.bP_T); ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP_T kC_T
        if (par.opt_bP_T & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.bP_T); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.bP_T); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.bP_T)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP_T kdC
        if (par.opt_bP_T & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.bP_T); ...
                   Z ; ...
                   -kC_kdC*DOCx(:,pindx.bP_T); ...
                   Z ; ...
                   -N2C*kC_kdC*DOCx(:,pindx.bP_T)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP_T R_Si
        if (par.opt_bP_T & par.opt_R_Si)
            kk = kk + 1;
            tmp = [-d0((1-sigma)*RR_Si*Gx(:,pindx.bP_T))*C2P ; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_Si*Gx(:,pindx.bP_T))*C2P ; ...
                   d0(-2*(1-sigma)*RR_Si*Gx(:,pindx.bP_T))*C2P] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP_T rR
        if (par.opt_bP_T & par.opt_rR)
            kk = kk + 1;
            tmp = [-d0((1-sigma)*RR_rR*Gx(:,pindx.bP_T))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_rR*Gx(:,pindx.bP_T))*C2P; ...
                   d0(-2*(1-sigma)*RR_rR*Gx(:,pindx.bP_T))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP_T cc
        if (par.opt_bP_T & par.opt_cc)
            kk = kk + 1;
            tmp = cc*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*C2P_cc; ...
                      (1-sigma)*d0(Gx(:,pindx.bP_T))*C2P_cc; ...
                      sigma*d0(Gx(:,pindx.bP_T))*C2P_cc; ...
                      d0((1-sigma)*RR*Gx(:,pindx.bP_T))*C2P_cc; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*C2P_cc + ...
                      d0(N2C*Gx(:,pindx.bP_T))*C2P_cc];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP_T dd
        if (par.opt_bP_T & par.opt_dd)
            kk = kk + 1;
            tmp = dd*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*C2P_dd; ...
                      (1-sigma)*d0(Gx(:,pindx.bP_T))*C2P_dd; ...
                      sigma*d0(Gx(:,pindx.bP_T))*C2P_dd; ...
                      d0((1-sigma)*RR*Gx(:,pindx.bP_T))*C2P_dd; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*C2P_dd + ...
                      d0(N2C*Gx(:,pindx.bP_T))*C2P_dd];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
%bP
        % bP bC_T
        if (par.opt_bP & par.opt_bC_T)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lbP); ...
                   Z ; ...
                   Z ; ...
                   Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP bC
        if (par.opt_bP & par.opt_bC)
            kk = kk + 1;
            tmp = [Z ; ...
                   -bC*PFD_bb*POCx(:,pindx.lbP); ...
                   Z ; ...
                   Z ; ...
                   Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP d
        if (par.opt_bP & par.opt_d)
            kk = kk + 1;
            tmp = [Z ; ...
                   Z ; ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.lbP); ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP kC_T
        if (par.opt_bP & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lbP); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lbP); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lbP)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP kdC
        if (par.opt_bP & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.lbP); ...
                   Z ; ...
                   -kC_kdC*DOCx(:,pindx.lbP); ...
                   Z ; ...
                   -N2C*kC_kdC*DOCx(:,pindx.lbP)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP R_Si
        if (par.opt_bP & par.opt_R_Si)
            kk = kk + 1;
            tmp = [-d0((1-sigma)*RR_Si*Gx(:,pindx.lbP))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_Si*Gx(:,pindx.lbP))*C2P; ...
                   d0(-2*(1-sigma)*RR_Si*Gx(:,pindx.lbP))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP rR
        if (par.opt_bP & par.opt_rR)
            kk = kk + 1;
            tmp = [-d0((1-sigma)*RR_rR*Gx(:,pindx.lbP))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_rR*Gx(:,pindx.lbP))*C2P; ...
                   d0(-2*(1-sigma)*RR_rR*Gx(:,pindx.lbP))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP cc
        if (par.opt_bP & par.opt_cc)
            kk = kk + 1;
            tmp = cc*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*C2P_cc; ...
                      (1-sigma)*d0(Gx(:,pindx.lbP))*C2P_cc;...
                      sigma*d0(Gx(:,pindx.lbP))*C2P_cc;...
                      d0((1-sigma)*RR*Gx(:,pindx.lbP))*C2P_cc; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*C2P_cc + ...
                      d0(N2C*Gx(:,pindx.lbP))*C2P_cc];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bP dd
        if (par.opt_bP & par.opt_dd)
            kk = kk + 1;
            tmp = dd*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*C2P_dd; ...
                      (1-sigma)*d0(Gx(:,pindx.lbP))*C2P_dd;...
                      sigma*d0(Gx(:,pindx.lbP))*C2P_dd;...
                      d0((1-sigma)*RR*Gx(:,pindx.lbP))*C2P_dd; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*C2P_dd + ...
                      d0(N2C*Gx(:,pindx.lbP))*C2P_dd];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% alpha
        % alpha bC_T
        if (par.opt_alpha & par.opt_bC_T)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lalpha); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % alpha bC
        if (par.opt_alpha & par.opt_bC)
            kk = kk + 1;
            tmp = [Z ; ...
                   -bC*PFD_bb*POCx(:,pindx.lalpha); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % alpha d
        if (par.opt_alpha & par.opt_d)
            kk = kk + 1;
            tmp = [Z ; ...
                   Z ; ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.lalpha); ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % alpha kC_T
        if (par.opt_alpha & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lalpha); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lalpha); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lalpha)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % alpha kdC
        if (par.opt_alpha & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.lalpha); ...
                   Z ; ...
                   -kC_kdC*DOCx(:,pindx.lalpha); ...
                   Z ; ...
                   -N2C*kC_kdC*DOCx(:,pindx.lalpha)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % alpha R_Si
        if (par.opt_alpha & par.opt_R_Si)
            kk  = kk + 1;
            tmp = [-d0((1-sigma)*RR_Si*Gx(:,pindx.lalpha))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_Si*Gx(:,pindx.lalpha))*C2P; ...
                   d0(-2*(1-sigma)*RR_Si*Gx(:,pindx.lalpha))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % alpha rR
        if (par.opt_alpha & par.opt_rR)
            kk  = kk + 1;
            tmp = [-d0((1-sigma)*RR_rR*Gx(:,pindx.lalpha))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_rR*Gx(:,pindx.lalpha))*C2P; ...
                   d0(-2*(1-sigma)*RR_rR*Gx(:,pindx.lalpha))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % alpha cc
        if (par.opt_alpha & par.opt_cc)
            kk  = kk + 1;
            tmp = cc*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*C2P_cc; ...
                      (1-sigma)*d0(Gx(:,pindx.lalpha))*C2P_cc; ...
                      sigma*d0(Gx(:,pindx.lalpha))*C2P_cc; ...
                      d0((1-sigma)*RR*Gx(:,pindx.lalpha))*C2P_cc; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*C2P_cc + ...
                      d0(N2C*Gx(:,pindx.lalpha))*C2P_cc];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % alpha dd
        if (par.opt_alpha & par.opt_dd)
            kk = kk + 1;
            tmp = dd*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*C2P_dd; ...
                      (1-sigma)*d0(Gx(:,pindx.lalpha))*C2P_dd; ...
                      sigma*d0(Gx(:,pindx.lalpha))*C2P_dd; ...
                      d0((1-sigma)*RR*Gx(:,pindx.lalpha))*C2P_dd; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*C2P_dd + ...
                      d0(N2C*Gx(:,pindx.lalpha))*C2P_dd];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% beta
        % beta bC_T
        if (par.opt_beta & par.opt_bC_T)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lbeta); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % beta bC
        if (par.opt_beta & par.opt_bC)
            kk = kk + 1;
            tmp = [Z ; ...
                   -bC*PFD_bb*POCx(:,pindx.lbeta); ...
                   Z ; ...
                   Z ; ...
                   Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % beta d
        if (par.opt_beta & par.opt_d)
            kk = kk + 1;
            tmp = [Z ; ...
                   Z ; ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.lbeta); ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % beta kC_T
        if (par.opt_beta & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lbeta); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lbeta); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lbeta)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % beta kdC
        if (par.opt_beta & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.lbeta); ...
                   Z ; ...
                   -kC_kdC*DOCx(:,pindx.lbeta); ...
                   Z ; ...
                   -N2C*kC_kdC*DOCx(:,pindx.lbeta)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % beta R_Si
        if (par.opt_beta & par.opt_R_Si)
            kk = kk + 1;
            tmp = [-d0((1-sigma)*RR_Si*Gx(:,pindx.lbeta))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_Si*Gx(:,pindx.lbeta))*C2P; ...
                   d0(-2*(1-sigma)*RR_Si*Gx(:,pindx.lbeta))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % beta rR
        if (par.opt_beta & par.opt_rR)
            kk = kk + 1;
            tmp = [-d0((1-sigma)*RR_rR*Gx(:,pindx.lbeta))*C2P; ...
                   Z ; ...
                   Z ; ...
                   d0((1-sigma)*RR_rR*Gx(:,pindx.lbeta))*C2P; ...
                   d0(-2*(1-sigma)*RR_rR*Gx(:,pindx.lbeta))*C2P];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % beta cc
        if (par.opt_beta & par.opt_cc)
            kk = kk + 1;
            tmp = cc*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*C2P_cc; ...
                      (1-sigma)*d0(Gx(:,pindx.lbeta))*C2P_cc; ...
                      sigma*d0(Gx(:,pindx.lbeta))*C2P_cc; ...
                      d0((1-sigma)*RR*Gx(:,pindx.lbeta))*C2P_cc; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*C2P_cc + ...
                      d0(N2C*Gx(:,pindx.lbeta))*C2P_cc];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % beta dd
        if (par.opt_beta & par.opt_dd)
            kk = kk + 1;
            tmp = dd*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*C2P_dd; ...
                      (1-sigma)*d0(Gx(:,pindx.lbeta))*C2P_dd; ...
                      sigma*d0(Gx(:,pindx.lbeta))*C2P_dd; ...
                      d0((1-sigma)*RR*Gx(:,pindx.lbeta))*C2P_dd; ...
                      d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*C2P_dd + ...
                      d0(N2C*Gx(:,pindx.lbeta))*C2P_dd];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

%%% P & Cell model Parameters
% sigma + Cell model params  %%% make this a loop
	   % sigma Q10Photo
	   if (par.opt_sigma & par.opt_Q10Photo)
		   kk = kk + 1;
		   tmp = [RR*sigma*G*C2P_Q10; ...
					 -sigma*G*C2P_Q10; ...
					 sigma*G*C2P_Q10; ...
					 -RR*sigma*G*C2P_Q10; ...
					 2*RR*sigma*G*C2P_Q10] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*C2P_Q10; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*C2P_Q10; ...
					 sigma*d0(Gx(:,pindx.lsigma))*C2P_Q10; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_Q10; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_Q10 + ...
					 d0(N2C*Gx(:,pindx.lsigma))*C2P_Q10];
		   tmp = tmp*dQ10_lQ10Photo;

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   if (par.opt_sigma & par.opt_fStorage)
		   kk = kk + 1;
		   tmp = [RR*sigma*G*C2P_fStor; ...
					 -sigma*G*C2P_fStor; ...
					 sigma*G*C2P_fStor; ...
					 -RR*sigma*G*C2P_fStor; ...
					 2*RR*sigma*G*C2P_fStor] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*C2P_fStor; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*C2P_fStor; ...
					 sigma*d0(Gx(:,pindx.lsigma))*C2P_fStor; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_fStor; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_fStor + ...
					 d0(N2C*Gx(:,pindx.lsigma))*C2P_fStor];
		   tmp = tmp*dfStor_lfStorage;

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   if (par.opt_sigma & par.opt_fRibE)
		   kk = kk + 1;
		   tmp = [RR*sigma*G*C2P_fRibE; ...
					 -sigma*G*C2P_fRibE; ...
					 sigma*G*C2P_fRibE; ...
					 -RR*sigma*G*C2P_fRibE; ...
					 2*RR*sigma*G*C2P_fRibE] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*C2P_fRibE; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*C2P_fRibE; ...
					 sigma*d0(Gx(:,pindx.lsigma))*C2P_fRibE; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_fRibE; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_fRibE + ...
					 d0(N2C*Gx(:,pindx.lsigma))*C2P_fRibE];
		   tmp = tmp*dfRibE_tfRibE;

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   if (par.opt_sigma & par.opt_kST0)
		   kk = kk + 1;
		   tmp = [RR*sigma*G*C2P_kST0; ...
					 -sigma*G*C2P_kST0; ...
					 sigma*G*C2P_kST0; ...
					 -RR*sigma*G*C2P_kST0; ...
					 2*RR*sigma*G*C2P_kST0] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*C2P_kST0; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*C2P_kST0; ...
					 sigma*d0(Gx(:,pindx.lsigma))*C2P_kST0; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_kST0; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_kST0 + ...
					 d0(N2C*Gx(:,pindx.lsigma))*C2P_kST0];
		   tmp = tmp*dkST0_lkST0;

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   if (par.opt_sigma & par.opt_PLip_PCutoff)
		   kk = kk + 1;
		   tmp = [RR*sigma*G*C2P_PCutoff; ...
					 -sigma*G*C2P_PCutoff; ...
					 sigma*G*C2P_PCutoff; ...
					 -RR*sigma*G*C2P_PCutoff; ...
					 2*RR*sigma*G*C2P_PCutoff] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*C2P_PCutoff; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*C2P_PCutoff; ...
					 sigma*d0(Gx(:,pindx.lsigma))*C2P_PCutoff; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_PCutoff; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*C2P_PCutoff + ...
					 d0(N2C*Gx(:,pindx.lsigma))*C2P_PCutoff];
		   tmp = tmp*dPCutoff_lPCutoff; 	% dPCutoff_lPCutoff = par.BIO.PLip_PCutoff

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   if (par.opt_sigma & par.opt_PLip_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PLipscale *dPLipscale_lPLipscale; % dPLipscale_lPLipscale = par.BIO.PLip_scale
		   tmp = [RR*sigma*G*dC2Ptmp; ...
					 -sigma*G*dC2Ptmp; ...
					 sigma*G*dC2Ptmp; ...
					 -RR*sigma*G*dC2Ptmp; ...
					 2*RR*sigma*G*dC2Ptmp] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lsigma))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   if (par.opt_sigma & par.opt_PStor_rCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff; % drCutoff_lrCutoff = par.BIO.PStor_rCutoff
		   tmp = [RR*sigma*G*dC2Ptmp; ...
					 -sigma*G*dC2Ptmp; ...
					 sigma*G*dC2Ptmp; ...
					 -RR*sigma*G*dC2Ptmp; ...
					 2*RR*sigma*G*dC2Ptmp] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lsigma))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   if (par.opt_sigma & par.opt_PStor_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale; % dPStorscale_lPStorscale = par.BIO.PStor_scale
		   tmp = [RR*sigma*G*dC2Ptmp; ...
					 -sigma*G*dC2Ptmp; ...
					 sigma*G*dC2Ptmp; ...
					 -RR*sigma*G*dC2Ptmp; ...
					 2*RR*sigma*G*dC2Ptmp] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lsigma))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   if (par.opt_sigma & par.opt_alphaS)
		   kk = kk + 1;
		   dC2Ptmp = C2P_alphaS * dalphaS_lalphaS; % dalphaS_lalphaS = par.BIO.alphaS
		   tmp = [RR*sigma*G*dC2Ptmp; ...
					 -sigma*G*dC2Ptmp; ...
					 sigma*G*dC2Ptmp; ...
					 -RR*sigma*G*dC2Ptmp; ...
					 2*RR*sigma*G*dC2Ptmp] + ...
				 [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lsigma))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lsigma))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lsigma))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	% kP_T + cell model
	   % kP_T Q10Photo
	   if (par.opt_kP_T & par.opt_Q10Photo)
		   kk = kk + 1;
		   dC2Ptmp = C2P_Q10 * dQ10_lQ10Photo; %dQ10_lQ10Photo = par.BIO.Q10Photo
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   % kP_T fStorage
	   if (par.opt_kP_T & par.opt_fStorage)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fStor * dfStor_lfStorage;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   % kP_T fRibE
	   if (par.opt_kP_T & par.opt_fRibE)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fRibE * dfRibE_tfRibE;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   % kP_T kST0
	   if (par.opt_kP_T & par.opt_kST0)
		   kk = kk + 1;
		   dC2Ptmp = C2P_kST0 * dkST0_lkST0;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   %kP_T PLip_PCutoff (C2P_PCutoff)
	   if (par.opt_kP_T & par.opt_PLip_PCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PCutoff * dPCutoff_lPCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   %kP_T PLip_scale
	   if (par.opt_kP_T & par.opt_PLip_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PLipscale * dPLipscale_lPLipscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   %kP_T PStor_rCutoff (C2P_rCutoff)
	   if (par.opt_kP_T & par.opt_PStor_rCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %kP_T PStor_scale
	   if (par.opt_kP_T & par.opt_PStor_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %kP_T alphaS
	   if (par.opt_kP_T & par.opt_alphaS)
		   kk = kk + 1;
		   dC2Ptmp = C2P_alphaS * dalphaS_lalphaS;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.kP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.kP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	% kdP + cell model
	   % kdP Q10Photo
	   if (par.opt_kdP & par.opt_Q10Photo)
		   kk = kk + 1;
		   dC2Ptmp = C2P_Q10 * dQ10_lQ10Photo; % dQ10_lQ10Photo =par.BIO.Q10Photo
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   %kdP fStorage
	   if (par.opt_kdP & par.opt_fStorage)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fStor * dfStor_lfStorage;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   %kdP fRibE
	   if (par.opt_kdP & par.opt_fRibE)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fRibE * dfRibE_tfRibE;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   %kdP kST0
	   if (par.opt_kdP & par.opt_kST0)
		   kk = kk + 1;
		   dC2Ptmp = C2P_kST0 * dkST0_lkST0;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   %kdP PLip_PCutoff (C2P_PCutoff)
	   if (par.opt_kdP & par.opt_PLip_PCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PCutoff * dPCutoff_lPCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %kdP PLip_scale (C2P_PLipscale)
	   if (par.opt_kdP & par.opt_PLip_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PLipscale * dPLipscale_lPLipscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   %kdP PStor_rCutoff (C2P_rCutoff)
	   if (par.opt_kdP & par.opt_PStor_rCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %kdP PStor_scale
	   if (par.opt_kdP & par.opt_PLip_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %kdP alphaS
	   if (par.opt_kdP & par.opt_alphaS)
		   kk = kk + 1;
		   dC2Ptmp = C2P_alphaS * dalphaS_lalphaS;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lkdP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lkdP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	% bP_T + cell model
	   % bP_T Q10Photo
	   if (par.opt_bP_T & par.opt_Q10Photo)
		   kk = kk + 1;
		   dC2Ptmp = C2P_Q10 * dQ10_lQ10Photo;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % bP_T fStorage
	   if (par.opt_bP_T & par.opt_fStorage)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fStor * dfStor_lfStorage;
		   tmp = par.BIO.fStorage*[-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % bP_T fRibE
	   if (par.opt_bP_T & par.opt_fRibE)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fRibE * dfRibE_tfRibE;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % bP_T kST0
	   if (par.opt_bP_T & par.opt_kST0)
		   kk = kk + 1;
		   dC2Ptmp = C2P_kST0 * dkST0_lkST0;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP_T PLip_PCutoff (C2P_PCutoff)
	   if (par.opt_bP_T & par.opt_PLip_PCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PCutoff * dPCutoff_lPCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP_T PLip_scale (C2P_PLipscale)
	   if (par.opt_bP_T & par.opt_PLip_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PLipscale * dPLipscale_lPLipscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP_T PStor_rCutoff (C2P_rCutoff)
	   if (par.opt_bP_T & par.opt_PStor_rCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP_T PStor_scale
	   if (par.opt_bP_T & par.opt_PStor_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP_T alphaS
	   if (par.opt_bP_T & par.opt_alphaS)
		   kk = kk + 1;
		   dC2Ptmp = C2P_alphaS * dalphaS_lalphaS;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.bP_T))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.bP_T))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	% bP + Cell model
	   % bP Q10Photo
	   if (par.opt_bP & par.opt_Q10Photo)
		   kk = kk + 1;
		   dC2Ptmp = C2P_Q10 * dQ10_lQ10Photo;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % bP fStorage
	   if (par.opt_bP & par.opt_fStorage)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fStor * dfStor_lfStorage;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % bP fRibE
	   if (par.opt_bP & par.opt_fRibE)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fRibE * dfRibE_tfRibE;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % bP kST0
	   if (par.opt_bP & par.opt_kST0)
		   kk = kk + 1;
		   dC2Ptmp = C2P_kST0 * dkST0_lkST0;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP PLip_PCutoff (C2P_PCutoff)
	   if (par.opt_bP & par.opt_PLip_PCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PCutoff * dPCutoff_lPCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP PLip_scale (C2P_PLipscale)
	   if (par.opt_bP & par.opt_PLip_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PLipscale * dPLipscale_lPLipscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP PStor_rCutoff (C2P_rCutoff)
	   if (par.opt_bP & par.opt_PStor_rCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP PStor_scale
	   if (par.opt_bP & par.opt_PStor_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %bP alphaS
	   if (par.opt_bP & par.opt_alphaS)
		   kk = kk + 1;
		   dC2Ptmp = C2P_alphaS * dalphaS_lalphaS;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 sigma*d0(Gx(:,pindx.lbP))*dC2Ptmp;...
					 d0((1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbP))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbP))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	% alpha +cell model
	   % alpha Q10Photo
	   if (par.opt_alpha & par.opt_Q10Photo)
		   kk = kk + 1;
		   dC2Ptmp = C2P_Q10 * dQ10_lQ10Photo;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	   % alpha fStorage
	   if (par.opt_alpha & par.opt_fStorage)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fStor * dfStor_lfStorage;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % alpha fRibE
	   if (par.opt_alpha & par.opt_fRibE)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fRibE * dfRibE_tfRibE;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % alpha kST0
	   if (par.opt_alpha & par.opt_kST0)
		   kk = kk + 1;
		   dC2Ptmp = C2P_kST0 * dkST0_lkST0;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %alpha PLip_PCutoff (C2P_PCutoff)
	   if (par.opt_alpha & par.opt_PLip_PCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PCutoff * dPCutoff_lPCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %alpha PLip_scale
	   if (par.opt_alpha & par.opt_PLip_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PLipscale * dPLipscale_lPLipscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %alpha PStor_rCutoff (C2P_rCutoff)
	   if (par.opt_alpha & par.opt_PStor_rCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %alpha PStor_scale
	   if (par.opt_alpha & par.opt_PStor_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   %alpha alphaS
	   if (par.opt_alpha & par.opt_alphaS)
		   kk = kk + 1;
		   dC2Ptmp = C2P_alphaS * dalphaS_lalphaS;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lalpha))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lalpha))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

	% beta + cell model
	   % beta Q10Photo
	   if (par.opt_beta & par.opt_Q10Photo)
		   kk = kk + 1;
		   dC2Ptmp = C2P_Q10 * dQ10_lQ10Photo;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % beta fStorage
	   if (par.opt_beta & par.opt_fStorage)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fStor * dfStor_lfStorage;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % beta fRibE
	   if (par.opt_beta & par.opt_fRibE)
		   kk = kk + 1;
		   dC2Ptmp = C2P_fRibE * dfRibE_tfRibE;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % beta kST0
	   if (par.opt_beta & par.opt_kST0)
		   kk = kk + 1;
		   dC2Ptmp = C2P_kST0 * dkST0_lkST0;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % beta PLip_PCutoff (C2P_PCutoff)
	   if (par.opt_beta & par.opt_PLip_PCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PCutoff * dPCutoff_lPCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % beta PLip_scale
	   if (par.opt_beta & par.opt_PLip_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PLipscale * dPLipscale_lPLipscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % beta PStor_rCutoff (C2P_rCutoff)
	   if (par.opt_beta & par.opt_PStor_rCutoff)
		   kk = kk + 1;
		   dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % beta PStor_scale
	   if (par.opt_beta & par.opt_PStor_scale)
		   kk = kk + 1;
		   dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end
	   % beta alphaS
	   if (par.opt_beta & par.opt_alphaS)
		   kk = kk + 1;
		   dC2Ptmp = C2P_alphaS * dalphaS_lalphaS;
		   tmp = [-d0((I+(1-sigma)*RR)*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 (1-sigma)*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 sigma*d0(Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0((1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp; ...
					 d0(-2*(1-sigma)*RR*Gx(:,pindx.lbeta))*dC2Ptmp + ...
					 d0(N2C*Gx(:,pindx.lbeta))*dC2Ptmp];

		   Cxx(:,kk) = mfactor(FD, tmp);
	   end

%%%% C model only parameters
        % bC_T bC_T
        if (par.opt_bC_T)
            kk = kk + 1;
            [~,~,Hout] = buildPFD(par,'POC');
            PFD_bm_bm = Hout.PFD_bm_bm;
            par.PFD_bm_bm = PFD_bm_bm;
            tmp = [Z ; ...
                   -PFD_bm_bm*POC-2*PFD_bm*POCx(:,pindx.bC_T);
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC_T bC
        if (par.opt_bC_T & par.opt_bC)
            kk = kk + 1;
            [~,~,Hout] = buildPFD(par,'POC');
            PFD_bm_bb = Hout.PFD_bm_bb;
            par.PFD_bm_bb = PFD_bm_bb;
            tmp =  [Z ; ...
                    [-bC*PFD_bm_bb*POC - ...
                     PFD_bm*POCx(:,pindx.lbC) - ...
                     bC*PFD_bb*POCx(:,pindx.bC_T)];
                    Z; Z; Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC_T d
        if (par.opt_bC_T & par.opt_d)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.ld); ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.bC_T); ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC_T kC_T
        if (par.opt_bC_T & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.bC_T) ; ...
                   -PFD_bm*POCx(:,pindx.kC_T); ...
                   -kC_kC_T*DOCx(:,pindx.bC_T) ; ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.bC_T)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC_T kdC
        if (par.opt_bC_T & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.bC_T) ; ...
                   -PFD_bm*POCx(:,pindx.lkdC); ...
                   -kC_kdC*DOCx(:,pindx.bC_T) ; ...
                   Z ; ...
                   -N2C*kC_kdC*DOCx(:,pindx.bC_T) ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC_T R_Si
        if (par.opt_bC_T & par.opt_R_Si)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.R_Si); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC_T rR
        if (par.opt_bC_T & par.opt_rR)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lrR); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC_T cc
        if (par.opt_bC_T & par.opt_cc)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lcc); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC_T dd
        if (par.opt_bC_T & par.opt_dd)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.ldd); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% insert bC_T + cell model params here?
        % bC bC
        if (par.opt_bC)
            kk = kk + 1;
            [~,~,Hout] = buildPFD(par,'POC');
            PFD_bb_bb = Hout.PFD_bb_bb;
            par.PFD_bb_bb = PFD_bb_bb;
            tmp = bC*[Z; ...
                      -PFD_bb*POC-bC*PFD_bb_bb*POC-2* ...
                      PFD_bb*POCx(:,pindx.lbC); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC d
        if (par.opt_bC & par.opt_d)
            kk = kk + 1;
            tmp = [Z ; ...
                   -bC*PFD_bb*POCx(:,pindx.ld); ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.lbC); ...
                  Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC kC_T
        if (par.opt_bC & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lbC); ...
                   -bC*PFD_bb*POCx(:,pindx.kC_T); ...
                   -kC_kC_T*DOCx(:,pindx.lbC); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lbC)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC kdC
        if (par.opt_bC & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.lbC); ...
                   -bC*PFD_bb*POCx(:,pindx.lkdC); ...
                   -kC_kdC*DOCx(:,pindx.lbC); ...
                   Z; ...
                   -N2C*kC_kdC*DOCx(:,pindx.lbC)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC R_Si
        if (par.opt_bC & par.opt_R_Si)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.R_Si); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC rR
        if (par.opt_bC & par.opt_rR)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lrR); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC cc
        if (par.opt_bC & par.opt_cc)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lcc); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % bC dd
        if (par.opt_bC & par.opt_dd)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.ldd); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% insert bC + cell model params here?
        % d d
        if (par.opt_d & par.opt_d)
            kk = kk + 1;
            [~,~,Hout] = buildPFD(par,'PIC');
            PFD_d_d = Hout.PFD_d_d;
            par.PFD_d_d = PFD_d_d;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     [-PFD_d*PIC - d*PFD_d_d*PIC + ...
                      -2*PFD_d*PICx(:,pindx.ld)]; ...
                    Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % d kC_T
        if (par.opt_d & par.opt_kC_T)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.ld); ...
                   Z
                   -kC_kC_T*DOCx(:,pindx.ld); ...
                   -d*PFD_d*PICx(:,pindx.kC_T); ...
                   -N2C*kC_kC_T*DOCx(:,pindx.ld)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % d kdC
        if (par.opt_d & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kdC*DOCx(:,pindx.ld); ...
                   Z ; ...
                   -kC_kdC*DOCx(:,pindx.ld); ...
                   -d*PFD_d*PICx(:,pindx.lkdC); ...
                   -N2C*kC_kdC*DOCx(:,pindx.ld)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % d R_Si
        if (par.opt_d & par.opt_R_Si)
            kk = kk + 1;
            tmp = [Z ; ...
                   Z ; ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.R_Si); ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % d rR
        if (par.opt_d & par.opt_rR)
            kk = kk + 1;
            tmp = [Z ; ...
                   Z ; ...
                   Z ; ...
                   -d*PFD_d*PICx(:,pindx.lrR); ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % d cc
        if (par.opt_d & par.opt_cc)
            kk = kk + 1;
            tmp = d*[Z; ...
                     Z; ...
                     Z; ...
                     -PFD_d*PICx(:,pindx.lcc); ...
                     Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % d dd
        if (par.opt_d & par.opt_dd)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.ldd); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% insert d + cell model params here?
        % kC_T kC_T
        if (par.opt_kC_T)
            kk = kk + 1;
            tmp = [2*kC_kC_T*DOCx(:,pindx.kC_T); ...
                   Z ; ...
                   -2*kC_kC_T*DOCx(:,pindx.kC_T); ...
                   Z ; ...
                   -2*N2C*kC_kC_T*DOCx(:,pindx.kC_T) ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kC_T kdC
        if (par.opt_kC_T & par.opt_kdC)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lkdC); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lkdC); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lkdC)] + ...
                  [kC_kdC*DOCx(:,pindx.kC_T); ...
                   Z ; ...
                   -kC_kdC*DOCx(:,pindx.kC_T); ...
                   Z ; ...
                   -N2C*kC_kdC*DOCx(:,pindx.kC_T)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kC_T R_Si
        if (par.opt_kC_T & par.opt_R_Si)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.R_Si); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.R_Si); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.R_Si)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kC_T rR
        if (par.opt_kC_T & par.opt_rR)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lrR); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lrR); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lrR)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kC_T cc
        if (par.opt_kC_T & par.opt_cc)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lcc); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lcc); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lcc)] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kC_T dd
        if (par.opt_kC_T & par.opt_dd)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.ldd); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.ldd); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.ldd)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% insert kC_T + cell model params here?
        % kdC kdC
        if (par.opt_kdC)
            kk = kk + 1;
            tmp = kC_kdC*[DOC + 2*DOCx(:,pindx.lkdC); ...
                          Z ; ...
                          -DOC - 2*DOCx(:,pindx.lkdC); ...
                          Z ; ...
                          -N2C*(DOC + 2*DOCx(:,pindx.lkdC))];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdC R_Si
        if (par.opt_kdC & par.opt_R_Si)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.R_Si); ...
                          Z ; ...
                          -DOCx(:,pindx.R_Si); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.R_Si)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdC rR
        if (par.opt_kdC & par.opt_rR)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lrR); ...
                          Z ; ...
                          -DOCx(:,pindx.lrR); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lrR)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdC cc
        if (par.opt_kdC & par.opt_cc)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lcc); ...
                          Z ; ...
                          -DOCx(:,pindx.lcc); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lcc)] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % kdC dd
        if (par.opt_kdC & par.opt_dd)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.ldd); ...
                          Z; ...
                          -DOCx(:,pindx.ldd); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.ldd)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% insert bC_T + cell model params here?
        %%%%%%
        % R_Si R_Si
        if (par.opt_R_Si)
            kk = kk + 1;
            tmp = [Z ; Z ; Z ; Z ; Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % R_Si rR
        if (par.opt_R_Si & par.opt_rR)
            kk = kk + 1;
            tmp = [Z ; Z ; Z ; Z ; Z];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % R_Si cc
        if (par.opt_R_Si & par.opt_cc)
            kk = kk + 1;
            tmp = [-cc*(1-sigma)*RR_Si*(G*C2P_cc); ...
                   Z ; ...
                   Z ; ...
                   cc*(1-sigma)*RR_Si*(G*C2P_cc); ...
                   -2*cc*(1-sigma)*RR_Si*(G*C2P_cc)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % R_Si dd
        if (par.opt_R_Si & par.opt_dd)
            kk = kk + 1;
            tmp = [-dd*(1-sigma)*RR_Si*(G*C2P_dd); ...
                   Z; ...
                   Z; ...
                   dd*(1-sigma)*RR_Si*(G*C2P_dd); ...
                   -2*dd*(1-sigma)*RR_Si*(G*C2P_dd)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% insert R_Si + cell model params here?
        % rR rR
        if (par.opt_rR)
            kk = kk + 1;
            tmp = [-(1-sigma)*RR_rR*(G*C2P); ...
                   Z ; ...
                   Z ; ...
                   (1-sigma)*RR_rR*(G*C2P); ...
                   -2*(1-sigma)*RR_rR*(G*C2P)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % rR cc
        if (par.opt_rR & par.opt_cc)
            kk = kk + 1;
            tmp = [-cc*(1-sigma)*RR_rR*(G*C2P_cc); ...
                   Z ; ...
                   Z ; ...
                   cc*(1-sigma)*RR_rR*(G*C2P_cc); ...
                   -2*cc*(1-sigma)*RR_rR*(G*C2P_cc)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % rR dd
        if (par.opt_rR & par.opt_dd)
            kk = kk + 1;
            tmp = [-dd*(1-sigma)*RR_rR*(G*C2P_dd); ...
                   Z; ...
                   Z; ...
                   dd*(1-sigma)*RR_rR*(G*C2P_dd); ...
                   -2*dd*(1-sigma)*RR_rR*(G*C2P_dd)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
% insert rR + cell model params here?
        %%%%%%%
        % cc cc
        if (par.opt_cc)
            kk = kk + 1;
            tmp = cc*[-(I+(1-sigma)*RR)*(G*(C2P_cc+cc*C2P_cc_cc)); ...
                      (1-sigma)*G*(C2P_cc+cc*C2P_cc_cc); ...
                      sigma*G*(C2P_cc+cc*C2P_cc_cc); ...
                      (1-sigma)*RR*(G*(C2P_cc+cc*C2P_cc_cc)); ...
                      -2*(1-sigma)*RR*(G*(C2P_cc+cc*C2P_cc_cc)) + ...
                      N2C*G*(C2P_cc+cc*C2P_cc_cc)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % cc dd
        if (par.opt_cc & par.opt_dd)
            kk = kk + 1;
            tmp = cc*dd*[-(I+(1-sigma)*RR)*(G*C2P_cc_dd); ...
                         (1-sigma)*G*C2P_cc_dd; ...
                         sigma*G*C2P_cc_dd; ...
                         (1-sigma)*RR*(G*C2P_cc_dd); ...
                         -2*(1-sigma)*RR*(G*C2P_cc_dd) + ...
                         N2C*G*C2P_cc_dd];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

        % dd dd
        if (par.opt_dd)
            kk = kk + 1;
            tmp = dd*[-(I+(1-sigma)*RR)*(G*(C2P_dd+dd*C2P_dd_dd)); ...
                      (1-sigma)*G*(C2P_dd+dd*C2P_dd_dd); ...
                      sigma*G*(C2P_dd+dd*C2P_dd_dd); ...
                      (1-sigma)*RR*(G*(C2P_dd+dd*C2P_dd_dd)); ...
                      -2*(1-sigma)*RR*(G*(C2P_dd+dd*C2P_dd_dd)) + ...
                      N2C*G*(C2P_dd+dd*C2P_dd_dd)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

	%%%%% Cmodel + Cell Model %%%%%
		% bC_T Q10Photo
        if (par.opt_bC_T & par.opt_Q10Photo)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lQ10Photo); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC_T fStorage
        if (par.opt_bC_T & par.opt_fStorage)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lfStorage); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC_T fRibE
        if (par.opt_bC_T & par.opt_fRibE)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.tfRibE); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC_T kST0
        if (par.opt_bC_T & par.opt_kST0)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lkST0); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC_T PLip_PCutoff
        if (par.opt_bC_T & par.opt_PLip_PCutoff)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lPLip_PCutoff); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC_T PLip_scale
        if (par.opt_bC_T & par.opt_PLip_scale)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lPLip_scale); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC_T PStor_rCutoff
        if (par.opt_bC_T & par.opt_PStor_rCutoff)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lPStor_rCutoff); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC_T PStor_scale
        if (par.opt_bC_T & par.opt_PStor_scale)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lPStor_scale); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC_T alphaS
        if (par.opt_bC_T & par.opt_alphaS)
            kk = kk + 1;
            tmp = [Z ; ...
                   -PFD_bm*POCx(:,pindx.lalphaS); ...
                   Z ; ...
                   Z ; ...
                   Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% bC Q10Photo
        if (par.opt_bC & par.opt_Q10Photo)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lQ10Photo); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC fStorage
        if (par.opt_bC & par.opt_fStorage)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lfStorage); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC fRibE
        if (par.opt_bC & par.opt_fRibE)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.tfRibE); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC kST0
        if (par.opt_bC & par.opt_kST0)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lkST0); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC PLip_PCutoff
        if (par.opt_bC & par.opt_PLip_PCutoff)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lPLip_PCutoff); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC PLip_scale
        if (par.opt_bC & par.opt_PLip_scale)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lPLip_scale); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC PStor_rCutoff
        if (par.opt_bC & par.opt_PStor_rCutoff)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lPStor_rCutoff); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC PStor_scale
        if (par.opt_bC & par.opt_PStor_scale)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lPStor_scale); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% bC alphaS
        if (par.opt_bC & par.opt_alphaS)
            kk = kk + 1;
            tmp = bC*[Z ; ...
                      -PFD_bb*POCx(:,pindx.lalphaS); ...
                      Z ; ...
                      Z ; ...
                      Z ];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% d Q10Photo
        if (par.opt_d & par.opt_Q10Photo)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.lQ10Photo); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% d fStorage
        if (par.opt_d & par.opt_fStorage)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.lfStorage); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% d fRibE
        if (par.opt_d & par.opt_fRibE)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.tfRibE); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% d kST0
        if (par.opt_d & par.opt_kST0)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.lkST0); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% d PLip_PCutoff
        if (par.opt_d & par.opt_PLip_PCutoff)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.lPLip_PCutoff); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% d PLip_scale
        if (par.opt_d & par.opt_PLip_scale)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.lPLip_scale); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% d PStor_rCutoff
        if (par.opt_d & par.opt_PStor_rCutoff)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.lPStor_rCutoff); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% d PStor_scale
        if (par.opt_d & par.opt_PStor_scale)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.lPStor_scale); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% d alphaS
        if (par.opt_d & par.opt_alphaS)
            kk = kk + 1;
            tmp = d*[Z ; ...
                     Z ; ...
                     Z ; ...
                     -PFD_d*PICx(:,pindx.lalphaS); ...
                     Z ] ;

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% kC_T Q10Photo
        if (par.opt_kC_T & par.opt_Q10Photo)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lQ10Photo); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lQ10Photo); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lQ10Photo)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kC_T fStorage
        if (par.opt_kC_T & par.opt_fStorage)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lfStorage); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lfStorage); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lfStorage)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kC_T fRibE
        if (par.opt_kC_T & par.opt_fRibE)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.tfRibE); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.tfRibE); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.tfRibE)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kC_T kST0
        if (par.opt_kC_T & par.opt_kST0)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lkST0); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lkST0); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lkST0)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kC_T PLip_PCutoff
        if (par.opt_kC_T & par.opt_PLip_PCutoff)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lPLip_PCutoff); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lPLip_PCutoff); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lPLip_PCutoff)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kC_T PLip_scale
        if (par.opt_kC_T & par.opt_PLip_scale)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lPLip_scale); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lPLip_scale); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lPLip_scale)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kC_T PStor_rCutoff
        if (par.opt_kC_T & par.opt_PStor_rCutoff)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lPStor_rCutoff); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lPStor_rCutoff); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lPStor_rCutoff)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kC_T PStor_scale
        if (par.opt_kC_T & par.opt_PStor_scale)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lPStor_scale); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lPStor_scale); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lPStor_scale)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kC_T alphaS
        if (par.opt_kC_T & par.opt_alphaS)
            kk = kk + 1;
            tmp = [kC_kC_T*DOCx(:,pindx.lalphaS); ...
                   Z ; ...
                   -kC_kC_T*DOCx(:,pindx.lalphaS); ...
                   Z ; ...
                   -N2C*kC_kC_T*DOCx(:,pindx.lalphaS)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% kdC Q10Photo
        if (par.opt_kdC & par.opt_Q10Photo)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lQ10Photo); ...
                          Z; ...
                          -DOCx(:,pindx.lQ10Photo); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lQ10Photo)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kdC fStorage
        if (par.opt_kdC & par.opt_fStorage)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lfStorage); ...
                          Z; ...
                          -DOCx(:,pindx.lfStorage); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lfStorage)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kdC fRibE
        if (par.opt_kdC & par.opt_fRibE)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.tfRibE); ...
                          Z; ...
                          -DOCx(:,pindx.tfRibE); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.tfRibE)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kdC kST0
        if (par.opt_kdC & par.opt_kST0)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lkST0); ...
                          Z; ...
                          -DOCx(:,pindx.lkST0); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lkST0)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kdC PLip_PCutoff
        if (par.opt_kdC & par.opt_PLip_PCutoff)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lPLip_PCutoff); ...
                          Z; ...
                          -DOCx(:,pindx.lPLip_PCutoff); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lPLip_PCutoff)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kdC PLip_scale
        if (par.opt_kdC & par.opt_PLip_scale)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lPLip_scale); ...
                          Z; ...
                          -DOCx(:,pindx.lPLip_scale); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lPLip_scale)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kdC PStor_rCutoff
        if (par.opt_kdC & par.opt_PStor_rCutoff)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lPStor_rCutoff); ...
                          Z; ...
                          -DOCx(:,pindx.lPStor_rCutoff); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lPStor_rCutoff)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kdC PStor_scale
        if (par.opt_kdC & par.opt_PStor_scale)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lPStor_scale); ...
                          Z; ...
                          -DOCx(:,pindx.lPStor_scale); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lPStor_scale)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% kdC alphaS
        if (par.opt_kdC & par.opt_alphaS)
            kk = kk + 1;
            tmp = kC_kdC*[DOCx(:,pindx.lalphaS); ...
                          Z; ...
                          -DOCx(:,pindx.lalphaS); ...
                          Z ; ...
                          -N2C*DOCx(:,pindx.lalphaS)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% R_Si Q10Photo
        if (par.opt_R_Si & par.opt_Q10Photo)
            kk = kk + 1;
			dC2Ptmp = C2P_Q10 * dQ10_lQ10Photo;
            tmp = [-(1-sigma)*RR_Si*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_Si*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% R_Si fStorage
        if (par.opt_R_Si & par.opt_fStorage)
            kk = kk + 1;
			dC2Ptmp = C2P_fStor * dfStor_lfStorage;
            tmp = [-(1-sigma)*RR_Si*G*dC2Ptmp; ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*G*dC2Ptmp; ...
                   -2*(1-sigma)*RR_Si*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% R_Si fRibE
        if (par.opt_R_Si & par.opt_fRibE)
            kk = kk + 1;
			dC2Ptmp = C2P_fRibE * dfRibE_tfRibE;
			tmp = [-(1-sigma)*RR_Si*G*dC2Ptmp; ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*G*dC2Ptmp; ...
                   -2*(1-sigma)*RR_Si*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% R_Si kST0
        if (par.opt_R_Si & par.opt_kST0)
            kk = kk + 1;
			dC2Ptmp = C2P_kST0 * dkST0_lkST0;
			tmp = [-(1-sigma)*RR_Si*G*dC2Ptmp; ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*G*dC2Ptmp; ...
                   -2*(1-sigma)*RR_Si*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		%R_Si PLip_PCutoff
		if (par.opt_R_Si & par.opt_PLip_PCutoff)
            kk = kk + 1;
			dC2Ptmp = C2P_PCutoff * dPCutoff_lPCutoff;
			tmp = [-(1-sigma)*RR_Si*G*dC2Ptmp; ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*G*dC2Ptmp; ...
                   -2*(1-sigma)*RR_Si*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		%R_Si PLip_scale
		if (par.opt_R_Si & par.opt_PLip_scale)
            kk = kk + 1;
			dC2Ptmp = C2P_PLipscale * dPLipscale_lPLipscale;
			tmp = [-(1-sigma)*RR_Si*G*dC2Ptmp; ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*G*dC2Ptmp; ...
                   -2*(1-sigma)*RR_Si*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		%R_Si PStor_rCutoff
		if (par.opt_R_Si & par.opt_PStor_rCutoff)
            kk = kk + 1;
			dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff;
			tmp = [-(1-sigma)*RR_Si*G*dC2Ptmp; ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*G*dC2Ptmp; ...
                   -2*(1-sigma)*RR_Si*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		%R_Si PStor_scale
		if (par.opt_R_Si & par.opt_PStor_scale)
            kk = kk + 1;
			dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale;
			tmp = [-(1-sigma)*RR_Si*G*dC2Ptmp; ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*G*dC2Ptmp; ...
                   -2*(1-sigma)*RR_Si*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		%R_Si alphaS
		if (par.opt_R_Si & par.opt_alphaS)
            kk = kk + 1;
			dC2Ptmp = C2P_alphaS * dalphaS_lalphaS;
			tmp = [-(1-sigma)*RR_Si*G*dC2Ptmp; ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_Si*G*dC2Ptmp; ...
                   -2*(1-sigma)*RR_Si*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% rR Q10Photo
        if (par.opt_rR & par.opt_Q10Photo)
            kk = kk + 1;
			dC2Ptmp = C2P_Q10 * dQ10_lQ10Photo;
			tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% rR fStorage
        if (par.opt_rR & par.opt_fStorage)
            kk = kk + 1;
			dC2Ptmp = C2P_fStor * dfStor_lfStorage;
			tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% rR fRibE
        if (par.opt_rR & par.opt_fRibE)
            kk = kk + 1;
			dC2Ptmp = C2P_fRibE * dfRibE_tfRibE;
			tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% rR kST0
        if (par.opt_rR & par.opt_kST0)
            kk = kk + 1;
			dC2Ptmp = C2P_kST0 * dkST0_lkST0;
			tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% rR PLip_PCutoff
        if (par.opt_rR & par.opt_PLip_PCutoff)
            kk = kk + 1;
			dC2Ptmp = C2P_PCutoff * dPCutoff_lPCutoff;
			tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% rR PLip_scale
        if (par.opt_rR & par.opt_PLip_scale)
            kk = kk + 1;
			dC2Ptmp = C2P_PLipscale * dPLipscale_lPLipscale;
			tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% rR PStor_rCutoff
        if (par.opt_rR & par.opt_PStor_rCutoff)
            kk = kk + 1;
			dC2Ptmp = C2P_rCutoff * drCutoff_lrCutoff;
			tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% rR PStor_scale
        if (par.opt_rR & par.opt_PStor_scale)
            kk = kk + 1;
			dC2Ptmp = C2P_PStorscale * dPStorscale_lPStorscale;
			tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% rR alphaS
        if (par.opt_rR & par.opt_alphaS)
            kk = kk + 1;
			dC2Ptmp = C2P_alphaS * dalphaS_lalphaS;
            tmp = [-(1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   Z; ...
                   Z; ...
                   (1-sigma)*RR_rR*(G*dC2Ptmp); ...
                   -2*(1-sigma)*RR_rR*(G*dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

	%%%%%%%%%%%% Cell model only %%%%%%%%%%%%%%%%%%%%%%%%%%%%
		ck = 0;
		for jj = 1:nbx %(npx+ncx+1):(npx+ncx+nbx)
			for jk = jj:nbx %jj:(npx+ncx+nbx)
				kk = kk + 1;
				ck = ck + 1;
				dC2Ptmp = C2Pxx(:,ck);
				tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
					 (1-sigma)*G*dC2Ptmp; ...
					 sigma*G*dC2Ptmp; ...
					 (1-sigma)*RR*(G*dC2Ptmp); ...
					 -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
					 N2C*G*dC2Ptmp];

				Cxx(:,kk) = mfactor(FD, tmp);
			end
		end
%-------- old version. skip to line end on line 4166 -------
%{
		% Q10Photo Q10Photo
        if (par.opt_Q10Photo)
			C2P_Q10_lQ10 = par.CellOut.d2C2P_dQ10Photo2(iwet); %complex step takes second deriv wrt log(Q10)
			d2Q10_lQ10Photo = par.BIO.Q10Photo;
            %dC2Ptmp = (C2P_Q10+par.BIO.Q10Photo*C2P_Q10_Q10)*par.BIO.Q10Photo;
			dC2Ptmp = (C2P_Q10 *d2Q10_lQ10Photo + C2P_Q10_lQ10*dQ10_lQ10Photo);
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% Q10Photo fStorage
        if (par.opt_Q10Photo & par.opt_fStorage)
			C2P_fStor_lQ10 = par.CellOut.d2C2P_dfStorage_dQ10Photo(iwet); %d2C2P/(dfStorage dlogQ10photo)
            dC2Ptmp=C2P_fStor_lQ10*dfStor_lfStorage;
			% dC2Ptmp = d/dlogQ10[dC2P/dfStorage *dfStorage/dlfStorage]
			% = dC2P/dfStorage * d/dlogQ10[dfStorage/dlfStorage] + d/dlogQ10[dC2P/dfStorage] *dfStorage/dlfStorage
			% = dC2P/dfStorage*0 + d/dlogQ10[dC2P/dfStorage] *dfStorage/dlfStorage
			% = C2P_fStor_lQ10 * dfStor_lfStorage
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% Q10Photo fRibE
		if (par.opt_Q10Photo & par.opt_fRibE)
			C2P_fRibE_lQ10 = par.CellOut.d2C2P_dfRibE_dQ10Photo(iwet);
            dC2Ptmp = C2P_fRibE_lQ10 *dfRibE_tfRibE;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% Q10Photo PLip_PCutoff
        if (par.opt_Q10Photo & par.opt_PLip_PCutoff)
			C2P_PCutoff_lQ10 = par.CellOut.d2C2P_dPCutoff_dQ10Photo(iwet);
			dC2Ptmp = C2P_PCutoff_lQ10 *dPCutoff_lPCutoff;
            kk = kk + 1;
			tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% Q10Photo PLip_scale
        if (par.opt_Q10Photo & par.opt_PLip_scale)
			C2P_PLipscale_lQ10 = par.CellOut.d2C2P_dPLipscale_dQ10Photo(iwet);
			dC2Ptmp = C2P_PLipscale_lQ10 *dPLipscale_lPLipscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% Q10Photo PStor_rCutoff
        if (par.opt_Q10Photo & par.opt_PStor_rCutoff)
			C2P_rCutoff_lQ10 = par.CellOut.d2C2P_drCutoff_dQ10Photo(iwet);
			dC2Ptmp = C2P_rCutoff_lQ10 * drCutoff_lrCutoff;
            kk = kk + 1;
			tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% Q10Photo PStor_scale
        if (par.opt_Q10Photo & par.opt_PStor_scale)
			C2P_PStorscale_lQ10 = par.CellOut.d2C2P_dPStorscale_dQ10Photo(iwet);
			dC2Ptmp = C2P_PStorscale_lQ10 * dPStorscale_lPStorscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% Q10Photo alphaS
        if (par.opt_Q10Photo & par.opt_alphaS)
			C2P_alphaS_lQ10 = par.CellOut.d2C2P_dalphaS_dQ10Photo(iwet);
			dC2Ptmp = C2P_alphaS_lQ10 * dalphaS_lalphaS;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% fStorage fStorage
        if (par.opt_fStorage)
			C2P_fStor_lfStor = par.CellOut.d2C2P_dfStorage2(iwet);
			d2fStor_lfStorage = par.BIO.fStorage;
			% dC2Ptmp = d/dlogfStor[dC2P/dfStorage *dfStorage/dlogfStor]
			% = dC2P/dfStorage * d/dlogfStor[dfStorage/dlogfStor] + d/dlogfStor[dC2P/dfStorage] *dfStorage/dlogfStor
			dC2Ptmp = C2P_fStor*d2fStor_lfStorage + C2P_fStor_lfStor*dfStor_lfStorage;
            kk = kk + 1;
			tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fStorage fRibE
        if (par.opt_fStorage & par.opt_fRibE)
			C2P_fRibE_lfStor = par.CellOut.d2C2P_dfRibE_dfStorage(iwet);
			dC2Ptmp = C2P_fRibE_lfStor * dfRibE_tfRibE;
            kk = kk + 1;
			tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fStorage PLip_PCutoff
        if (par.opt_fStorage & par.opt_PLip_PCutoff)
			C2P_PCutoff_lfStor = par.CellOut.d2C2P_dPCutoff_dfStorage(iwet);
			dC2Ptmp = C2P_PCutoff_lfStor * dPCutoff_lPCutoff;
            kk = kk + 1;
			tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fStorage PLip_scale
        if (par.opt_fStorage & par.opt_PLip_scale)
			C2P_PLipscale_lfStor = par.CellOut.d2C2P_dPLipscale_dfStorage(iwet);
			dC2Ptmp = C2P_PLipscale_lfStor * dPLipscale_lPLipscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fStorage PStor_rCutoff
        if (par.opt_fStorage & par.opt_PStor_rCutoff)
			C2P_rCutoff_lfStor = par.CellOut.d2C2P_drCutoff_dfStorage(iwet);
			dC2Ptmp = C2P_rCutoff_lfStor * drCutoff_lrCutoff;
            kk = kk + 1;
			tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fStorage PStor_scale
        if (par.opt_fStorage & par.opt_PStor_scale)
			C2P_PStorscale_lfStor = par.CellOut.d2C2P_dPStorscale_dfStorage(iwet);
			dC2Ptmp = C2P_PStorscale_lfStor * dPStorscale_lPStorscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fStorage alphaS
        if (par.opt_fStorage & par.opt_alphaS)
			C2P_alphaS_lfStor = par.CellOut.d2C2P_dalphaS_dfStorage(iwet);
			dC2Ptmp = C2P_alphaS_lfStor * dalphaS_lalphaS;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fRibE fRibE
		if (par.opt_fRibE)
			C2P_fRibE_tfRibE = par.CellOut.d2C2P_dfRibE2(iwet);
			d2fRibE_tfRibE = -sech(tfRibE)^2 * tanh(tfRibE);
			% dC2Ptmp = d/dtfRibE[dC2P/dfRibE *dfRibE/dtfRibE]
			% = dC2P/dfRibE * d/dtfRibE[dfRibE/dtfRibE] + d/dtfRibE[dC2P/dfRibE] *dfRibE/dtfRibE
			dC2Ptmp = C2P_fRibE * d2fRibE_tfRibE + C2P_fRibE_tfRibE * dfRibE_tfRibE;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fRibE PLip_PCutoff
		if (par.opt_fRibE & par.opt_PLip_PCutoff)
            C2P_PCutoff_tfRibE = par.CellOut.d2C2P_dPCutoff_dfRibE(iwet);
			dC2Ptmp = C2P_PCutoff_tfRibE * dPCutoff_lPCutoff;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fRibE PLip_scale
		if (par.opt_fRibE & par.opt_PLip_scale)
            C2P_PLipscale_tfRibE = par.CellOut.d2C2P_dPLipscale_dfRibE(iwet);
			dC2Ptmp = C2P_PLipscale_tfRibE * dPLipscale_lPLipscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fRibE PStor_rCutoff
		if (par.opt_fRibE & par.opt_PStor_rCutoff)
            C2P_rCutoff_tfRibE = par.CellOut.d2C2P_drCutoff_dfRibE(iwet);
			dC2Ptmp = C2P_rCutoff_tfRibE * drCutoff_lrCutoff;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fRibE PStor_scale
		if (par.opt_fRibE & par.opt_PStor_scale)
            C2P_PStorscale_tfRibE =  par.CellOut.d2C2P_dPStorscale_dfRibE(iwet);
			dC2Ptmp = C2P_PStorscale_tfRibE * dPStorscale_lPStorscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% fRibE alphaS
		if (par.opt_fRibE & par.opt_alphaS)
            C2P_alphaS_tfRibE =  par.CellOut.d2C2P_dalphaS_dfRibE(iwet);
			dC2Ptmp = C2P_alphaS_tfRibE * dalphaS_lalphaS;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% PLip_PCutoff PLip_PCutoff
		if (par.opt_PLip_PCutoff)
			C2P_PCutoff_lPCutoff = par.CellOut.d2C2P_dPCutoff2(iwet);
			d2PCutoff_lPCutoff = par.BIO.PLip_PCutoff;
			dC2Ptmp = C2P_PCutoff * d2PCutoff_lPCutoff + C2P_PCutoff_lPCutoff * dPCutoff_lPCutoff;
			% dC2Ptmp = d/dlogX[dC2P/dX *dX/dlogX]
			% = dC2P/dPCutoff * d/dlogPCutoff[dPCutoff/dlogPCutoff + d/dlogPCutoff[dC2P/dPCutoff] *dPCutoff/dlogPCutoff
            kk = kk + 1;
			tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% PLip_PCutoff PLip_scale
        if (par.opt_PLip_PCutoff & par.opt_PLip_scale)
			C2P_PLipscale_lPCutoff = par.CellOut.d2C2P_dPLipscale_dPCutoff(iwet);
            dC2Ptmp = C2P_PLipscale_lPCutoff * dPLipscale_lPLipscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% PLip_PCutoff PStor_rCutoff
        if (par.opt_PLip_PCutoff & par.opt_PStor_rCutoff)
			C2P_rCutoff_lPCutoff = par.CellOut.d2C2P_drCutoff_dPCutoff(iwet);
            dC2Ptmp = C2P_rCutoff_lPCutoff *drCutoff_lrCutoff;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% PLip_PCutoff PStor_scale
        if (par.opt_PLip_PCutoff & par.opt_PStor_scale)
            C2P_PStorscale_lPCutoff = par.CellOut.d2C2P_dPStorscale_dPCutoff(iwet);
			dC2Ptmp = C2P_PStorscale_lPCutoff * dPStorscale_lPStorscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% PLip_PCutoff alphaS
        if (par.opt_PLip_PCutoff & par.opt_alphaS)
            C2P_alphaS_lPCutoff = par.CellOut.d2C2P_dalphaS_dPCutoff(iwet);
			dC2Ptmp = C2P_alphaS_lPCutoff * dalphaS_lalphaS;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% PLip_scale
		if (par.opt_PLip_scale)
			C2P_PLipscale_lPLipscale = par.CellOut.d2C2P_dPLipscale2(iwet);
			d2PLipscale_lPLipscale = par.BIO.PLip_scale;
			dC2Ptmp = C2P_PLipscale * d2PLipscale_lPLipscale + C2P_PLipscale_lPLipscale * dPLipscale_lPLipscale;
			% dC2Ptmp = d/dlogX[dC2P/dX *dX/dlogX]
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% PLip_scale PStor_rCutoff
        if (par.opt_PLip_scale & par.opt_PStor_rCutoff)
            C2P_rCutoff_lPLipscale = par.CellOut.d2C2P_drCutoff_dPLipscale(iwet);
			dC2Ptmp = C2P_rCutoff_lPLipscale * drCutoff_lrCutoff;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% PLip_scale PStor_scale
        if (par.opt_PLip_scale & par.opt_PStor_scale)
            C2P_PStorscale_lPLipscale = par.CellOut.d2C2P_dPStorscale_dPLipscale(iwet);
			dC2Ptmp = C2P_PStorscale_lPLipscale * dPStorscale_lPStorscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% PLip_scale alphaS
        if (par.opt_PLip_scale & par.opt_alphaS)
            C2P_alphaS_lPLipscale = par.CellOut.d2C2P_dalphaS_dPLipscale(iwet);
			dC2Ptmp = C2P_alphaS_lPLipscale * dalphaS_lalphaS;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% PStor_rCutoff PStor_rCutoff
		if (par.opt_PStor_rCutoff)
			C2P_rCutoff_lrCutoff = par.CellOut.d2C2P_drCutoff2(iwet);
			d2rCutoff_lrCutoff = par.BIO.PStor_rCutoff;
			dC2Ptmp = C2P_rCutoff * d2rCutoff_lrCutoff + C2P_rCutoff_lrCutoff * drCutoff_lrCutoff;
			% dC2Ptmp = d/dlogX[dC2P/dX *dX/dlogX]
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
		% PStor_rCutoff PStor_scale
		if (par.opt_PStor_rCutoff & par.opt_PStor_scale)
            C2P_PStorscale_lrCutoff = par.CellOut.d2C2P_dPStorscale_drCutoff(iwet);
			dC2Ptmp = C2P_PStorscale_lrCutoff * dPStorscale_lPStorscale;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% PStor_rCutoff alphaS
		if (par.opt_PStor_rCutoff & par.opt_alphaS)
            C2P_alphaS_lrCutoff = par.CellOut.d2C2P_dalphaS_drCutoff(iwet);
			dC2Ptmp = C2P_alphaS_lrCutoff * dalphaS_lalphaS;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% PStor_scale PStor_scale
		if (par.opt_PStor_scale)
			C2P_PStorscale_lPStorscale = par.CellOut.d2C2P_dPStorscale2(iwet);
			d2PStorscale_lPStorscale = par.BIO.PStor_scale;
			dC2Ptmp = C2P_PStorscale * d2PStorscale_lPStorscale + C2P_PStorscale_lPStorscale * dPStorscale_lPStorscale;
			% dC2Ptmp = d/dlogX[dC2P/dX *dX/dlogX]
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% PStor_scale alphaS
		if (par.opt_PStor_scale & par.opt_alphaS)
            C2P_alphaS_lPStorscale = par.CellOut.d2C2P_dalphaS_dPStorscale(iwet);
			dC2Ptmp = C2P_alphaS_lPStorscale *dalphaS_lalphaS;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*dC2Ptmp); ...
                         (1-sigma)*G*dC2Ptmp; ...
                         sigma*G*dC2Ptmp; ...
                         (1-sigma)*RR*(G*dC2Ptmp); ...
                         -2*(1-sigma)*RR*(G*dC2Ptmp) + ...
                         N2C*G*dC2Ptmp];

            Cxx(:,kk) = mfactor(FD, tmp);
        end

		% alphaS alphaS
		if (par.opt_alphaS)
			C2P_alphaS_lalphaS = par.CellOut.d2C2P_dalphaS2(iwet);
			d2alphaS_lalphaS = par.BIO.alphaS;
            dC2Ptmp = C2P_alphaS*d2alphaS_lalphaS + C2P_alphaS_lalphaS * dalphaS_lalphaS;
            kk = kk + 1;
            tmp = [-(I+(1-sigma)*RR)*(G*(dC2Ptmp)); ...
                      (1-sigma)*G*(dC2Ptmp); ...
                      sigma*G*(dC2Ptmp); ...
                      (1-sigma)*RR*(G*(dC2Ptmp)); ...
                      -2*(1-sigma)*RR*(G*(dC2Ptmp)) + ...
                      N2C*G*(dC2Ptmp)];

            Cxx(:,kk) = mfactor(FD, tmp);
        end
%}
	end % end hessian (if optim == on, Cxx= [];)
end % end function C_eqn
